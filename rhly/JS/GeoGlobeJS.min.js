window.Geo={singleFile:!0};
(function(){window.Geo=window.Geo||{};window.Geo.Service={};window.Geo.Query={};window.Geo.Math={};window.Geo.Analysis={};window.Geo.View2D={};window.Geo.View2D.Control=OpenLayers.Control;window.Geo.View3D={};window.Geo.View3D.Event={};window.Geo.Bounds=OpenLayers.Bounds;window.Geo.Class=OpenLayers.Class;window.Geo.LonLat=OpenLayers.LonLat;window.Geo.Pixel=OpenLayers.Pixel;window.Geo.Size=OpenLayers.Size;window.Geo.Feature=OpenLayers.Feature;window.Geo.Filter=OpenLayers.Filter;window.Geo.Format=OpenLayers.Format;
window.Geo.Geometry=OpenLayers.Geometry;window.Geo.View2D.Handler=OpenLayers.Handler;window.Geo.View2D.Layer=OpenLayers.Layer;window.Geo.View2D.Popup=OpenLayers.Popup;window.Geo.Protocol=OpenLayers.Protocol;window.Geo.Request=OpenLayers.Request;window.Geo.Strategy=OpenLayers.Strategy;window.Geo.Symbolizer=OpenLayers.Symbolizer;window.Geo.View2D.Tile=OpenLayers.Tile;window.Geo.View2D.Event=OpenLayers.Event;window.Geo.View2D.Events=OpenLayers.Events;window.Geo.View2D.Icon=OpenLayers.Icon;window.Geo.Projection=
OpenLayers.Projection;window.Geo.Rule=OpenLayers.Rule;window.Geo.Style=OpenLayers.Style;window.Geo.Style2=OpenLayers.Style2;window.Geo.StyleMap=OpenLayers.StyleMap;for(var a=["Animater.js","Util.js","Pyramid.js","Util/Uuid.js","Util/Format/BusCapabilities.js","Util/Format/GlobeTileCapabilities.js","Util/Format/Pyramid.js","Util/Format/XML2JSON.js","View2D/Map.js","View2D/Layer/GlobeTile.js","View2D/Layer/CWMS.js","View2D/BaseLayerGroup.js","View2D/LayerGroup.js","View2D/FeatureManager.js","View2D/Control/DrawCircle.js",
"View2D/Control/DrawPath.js","View2D/Control/DrawPoint.js","View2D/Control/DrawPolygon.js","View2D/Control/DrawRectangle.js","View2D/Control/MagnifyingGlass.js","View2D/Control/GeoOverviewMap.js","View3D/Map.js","View3D/Layer.js","View3D/BaseLayerGroup.js","View3D/LayerGroup.js","View3D/Layer/GlobeTile.js","View3D/Layer/Model.js","View3D/Layer/Shape.js","View3D/Layer/Terrain.js","View3D/Layer/Vector.js","View3D/Layer/WMS.js","View3D/Layer/WMTS.js","View3D/Layer/WTFS.js","View3D/Layer/Solid.js","View3D/Layer/WCS.js",
"View3D/Event/MouseEvent.js","View3D/Handler.js","View3D/Handler/KeybordDefaults.js","View3D/Handler/Mouse.js","View3D/Handler/Point.js","View3D/Handler/Path.js","View3D/Handler/Polygon.js","View3D/Handler/Box.js","View3D/Handler/ModelChoose.js","View3D/Control.js","View3D/Control/KeyboardDefaults.js","View3D/Control/Measure.js","View3D/Control/DrawPath.js","View3D/Control/DrawPoint.js","View3D/Control/DrawPolygon.js","View3D/Control/DrawFeature.js","View3D/Control/SelectFeature.js","View3D/Control/Attribution.js",
"View3D/Control/Box.js","View3D/Control/Mouse.js","View3D/Control/ModelChoose.js","View3D/Fly.js","View3D/Popup.js","View3D/Popup/FramedCloud.js","View3D/FeatureManager.js","View3D/Control/Measure/PointInfo.js","View3D/Control/Measure/Distance.js","View3D/Control/Measure/Area.js","View3D/Control/Measure/Volume.js","View3D/Control/Measure/Excavate.js","View3D/Control/Measure/Flood.js","View3D/Control/Measure/Profile.js","View3D/Control/Measure/TwoPointThrough.js","CombineView.js","LayerManager.js",
"Analysis/BufferAnalysis.js","Analysis/SuperposeAnalysis.js","Query/WFSQuery.js","Query/CatalogQuery.js","Service.js","Service/GlobeTile.js","Service/Bus.js","Service/Plot.js","Service/ShortestPath.js","Service/TAS.js","Service/WPS.js","Service/WFS.js","Service/WMS.js","Service/WMTS.js","Service/WCS.js","Service/CSW.js","Service/CWMS.js"],b="",c=/(^|(.*?\/))(GeoGlobeJSAPI.js)(\?|$)/,d=document.getElementsByTagName("script"),e=0,f=d.length;e<f;e++){var g=d[e].getAttribute("src");if(g&&(g=g.match(c))){b=
g[1];break}}e=navigator.userAgent;if(c=e.match("MSIE")||e.match("Safari"))var h=Array(a.length);e=0;for(f=a.length;e<f;e++)c?h[e]="<script src='"+b+a[e]+"'><\/script>":(d=document.createElement("script"),d.src=b+a[e],(document.getElementsByTagName("head").length?document.getElementsByTagName("head")[0]:document.body).appendChild(d));c&&!Geo.singleFile&&document.write(h.join(""));Geo.scriptName="GeoGlobeJSAPI.js";Geo.getScriptLocation=function(){for(var a="",b=RegExp("(^|(.*?\\/))("+Geo.scriptName+
")(\\?|$)"),c=document.getElementsByTagName("script"),d=0,e=c.length;d<e;d++){var f=c[d].getAttribute("src");if(f&&(f=f.match(b))){a=f[1];break}}return a};Geo.imagesPath="";Geo.createNS=function(a){for(var a=a.split("."),b=window,c=0;c<a.length;c++)b[a[c]]||(b[a[c]]={}),b=b[a[c]]};Geo.VERSION_NUMBER="GeoGlobeJSAPI 0.01 -- $Revision: 20110321 $"})();
Geo.Animator=Geo.Class({id:null,_queue:null,_currentIndex:0,feature:null,isPlaying:!1,isRepeat:!0,frequence:5,initialize:function(){this.id=OpenLayers.Util.createUniqueID("Geo.Animater_");this._queue=[]},setFeature:function(a){this.feature=a},start:function(){var a=this._queue[this._currentIndex];if(a){var b=OpenLayers.Function.bind(function(){this._stepRun(a)},this);a.interval=window.setInterval(b,this.frequence)}},stop:function(){for(var a=this._currentIndex=0;a<this._queue.length;a++){var b=this._queue[a];
window.clearInterval(b.interval);b.counter=0}},pause:function(){window.clearInterval(this._queue[this._currentIndex].interval)},_getQueueItem:function(){return{counter:0,isStop:!1,doFn:function(){},checkStopFn:function(){return!1},interval:null,options:{}}},_addItem:function(a,b,c){var d=this._getQueueItem();if(a)d.doFn=OpenLayers.Function.bind(a,this);if(b)d.checkStopFn=OpenLayers.Function.bind(b,this);d.options=c;this._queue.push(d)},_stepRun:function(a){if(a.checkStopFn()){window.clearInterval(a.interval);
a.counter=0;var a=OpenLayers.Util.indexOf(this._queue,a)+1,b=this._queue[a];if(a!==0&&b){var c=OpenLayers.Function.bind(function(){this._stepRun(b)},this);b.interval=window.setInterval(c,500);this._currentIndex=a}else this._currentIndex=0,this.onStop()}else a.doFn(a),a.counter++},onStop:function(){},onChange:function(){},moveTo:function(a,b){var c=this.feature;new Geo.LonLat(c.geometry.x,c.geometry.y);b=b||{};b={from:null,to:a,currentPosition:null,step:b.ratio||0.1};this._addItem(function(a){var b=
this.feature,a=this._queue[this._currentIndex];this._moveFeature(b,a);this.onChange(b,"move")},function(){var a=this._queue[this._currentIndex],b=new Geo.LonLat(c.geometry.x,c.geometry.y),a=a.options;a.from=a.from||b;a.currentPosition=b;return this._checkIsOver(a.from,a.to,b)},b);return this},moveAlong:function(a,b){var c;a.CLASS_NAME=="OpenLayers.Feature.Vector"&&(c=this._getLonLatFromGeometry(a.geometry));for(var d=0;d<c.length;d++){var e=OpenLayers.Util.extend({},b);if(d==0)e.ratio=1;this.moveTo(c[d],
e)}},_getLonLatFromGeometry:function(a){for(var a=a.components,b=[],c=0;c<a.length;c++)b.push(new Geo.LonLat(a[c].x,a[c].y));return b},_moveFeature:function(a,b){var c=b.options,d=c.to;if(b.counter==0)c.from=new Geo.LonLat(a.geometry.x,a.geometry.y);var e=c.from,f=this._getMoveLonLat(e,d,c.step*b.counter),d=this._getMoveDirection(e,d);a.style.rotation=d;a.move(f);c.currentPosition=f},_checkIsOver:function(a,b,c){if(c.lon==b.lon&&c.lat==b.lat)return!0;var d=!1;a.lat<b.lat?(b=b.lat,d=a.lat):(d=b.lat,
b=a.lat);return(d=c.lat>b||c.lat<d)&&d},animate:function(){},fadeIn:function(){},fadeOut:function(){},hide:function(){},show:function(){},_getMoveLonLat:function(a,b,c){c>1&&(c=1);var d;d=a.lon===b.lon?a.lon:a.lon+c*(b.lon-a.lon);c=a.lat===b.lat?a.lat:a.lat+c*(b.lat-a.lat);a.lon<b.lon&&(d=d>b.lon?b.lon:d,d=d<a.lon?a.lon:d);a.lon>b.lon&&(d=d<b.lon?b.lon:d,d=d>a.lon?a.lon:d);a.lat<b.lat&&(c=c>b.lat?b.lat:c,c=c<a.lat?a.lat:c);a.lat>b.lat&&(c=c<b.lat?b.lat:c,c=c>a.lat?a.lat:c);return new Geo.LonLat(d,
c)},_getPointsByNum:function(a,b,c){var d=a.x,a=a.y,e;e=b.y;var f=[];percentX=(b.x-d)/(c-1);percentY=(e-a)/(c-1);for(var g=0;g<c;g++)b=d+percentX*g,e=a+percentY*g,f.push([b,e]);return f},_getAllTempPointByPercent:function(a,b,c){for(var d=[],e=0;e<1;){var f=getXorY(a.x,b.x,e),g=getXorY(a.y,b.y,e);d.push([f,g]);e+=c}e>=1&&d.push([b.x,b.y]);return d},_getMoveDirection:function(a,b){var c=Math.atan2(Math.abs(a.lon-b.lon),Math.abs(a.lat-b.lat));b.lon>=a.lon?b.lat>=a.lat||(c=Math.PI-c):c=b.lat>=a.lat?
2*Math.PI-c:Math.PI+c;return c*180/Math.PI},CLASS_NAME:"Geo.Animator"});Geo.Util={meterToDegree:function(a,b){return a*(8.99E-6/Math.cos(OpenLayers.Util.rad(b.lat)))},webColorToHex:function(a){return new Number("0x00"+a.replace("#",""))},replaceAll:function(a,b,c){return a.replace(RegExp(b,"gm"),c?c:"")},Format:{}};
Geo.Pyramid=Geo.Class({name:null,pyramidID:null,description:null,topLevelIndex:null,bottomLevelIndex:null,scaleX:null,scaleY:null,tileSize:null,originRowIndex:null,originColIndex:null,topTileFromX:null,topTileFromY:null,topTileToX:null,topTileToY:null,units:"degrees",initialize:function(a){if(!a||a==={})a=Geo.Pyramid.DEFAULT_PYRAMID;OpenLayers.Util.extend(this,a)},getMaxExtent:function(){var a,b,c,d;this.topTileFromX<this.topTileToX?(a=this.topTileFromX,c=this.topTileToX):(c=this.topTileFromX,a=this.topTileToX);
this.topTileFromY<this.topTileToY?(b=this.topTileFromY,d=this.topTileToY):(d=this.topTileFromY,b=this.topTileToY);return new Geo.Bounds(a,b,c,d)},getLevelForResolution:function(a){if(!a)return 0;a=this.getMaxResolution()/a;if(a<1)return 0;for(var b=0;a/2>=1;)b++,a=Math.round(a/2);return b},getLevelForScale:function(a){return this.getLevelForResolution(OpenLayers.Util.getResolutionFromScale(a,this.units))},getResolutionForScale:function(a){return this.getResolutionForLevel(this.getLevelForScale(a,
this.units))},getResolutionForLevel:function(a){return this.getTopTileSize().w/this.tileSize.w/Math.pow(2,a)},getMaxResolution:function(){return this.getResolutionForLevel(this.topLevelIndex)},getMinResolution:function(){return this.getResolutionForLevel(this.bottomLevelIndex)},getNumZoomLevels:function(){return this.bottomLevelIndex-this.topLevelIndex+1},getTopTileSize:function(){return new Geo.Size(Math.abs(this.topTileToX-this.topTileFromX),Math.abs(this.topTileToY-this.topTileFromY))},getTileIndex:function(a,
b){var c=a.lon,d=a.lat,e=this.getTopTileSize().w/Math.pow(2,b),f=this.maxExtent.getWidth(),g=this.maxExtent.getHeight(),f=Math.round(f/e),g=Math.round(g/e),c=Math.ceil(Math.abs(c-this.topTileFromX)/e)-1;this.topTileFromX<this.topTileToX||(c=f-c);d=Math.ceil(Math.abs(d-this.topTileFromY)/e)-1;this.topTileFromY>this.topTileToY||(d=g-d);return{col:c,row:d}},clone:function(){return OpenLayers.Util.extend({},this)},CLASS_NAME:"Geo.Pyramid"});
Geo.Pyramid.Degree360={name:"360DegreePyramid",topLevelIndex:0,bottomLevelIndex:20,scaleX:2,scaleY:2,topTileFromX:-180,topTileFromY:90,topTileToX:180,topTileToY:-270,tileSize:new Geo.Size(256,256),originRowIndex:0,originColIndex:0,maxExtent:new Geo.Bounds(-180,-90,180,90)};
Geo.Pyramid.Degree18={name:"18DegreePyramid",topLevelIndex:0,bottomLevelIndex:20,scaleX:2,scaleY:2,topTileFromX:-180,topTileFromY:-90,topTileToX:-162,topTileToY:-72,tileSize:new Geo.Size(256,256),originRowIndex:0,originColIndex:0,maxExtent:new Geo.Bounds(-180,-90,180,90)};Geo.Pyramid.DEFAULT_PYRAMID=Geo.Pyramid.Degree360;
(function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");Geo.Math.uuid=function(b,c){var d=[],c=c||a.length;if(b)for(var e=0;e<b;e++)d[e]=a[0|Math.random()*c];else{var f;d[8]=d[13]=d[18]=d[23]="-";d[14]="4";for(e=0;e<36;e++)d[e]||(f=0|Math.random()*16,d[e]=a[e==19?f&3|8:f])}return d.join("")};Geo.Math.uuidFast=function(){for(var b=Array(36),c=0,d,e=0;e<36;e++)e==8||e==13||e==18||e==23?b[e]="-":e==14?b[e]="4":(c<=2&&(c=33554432+Math.random()*16777216|0),d=c&15,c>>=
4,b[e]=a[e==19?d&3|8:d]);return b.join("")};Geo.Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=Math.random()*16|0;return(a=="x"?c:c&3|8).toString(16)}).toUpperCase()}})();
Geo.Util.Format.BusCapabilities=Geo.Class(Geo.Format.XML,{tagName:"NETWORK_Capabilities",read:function(a){typeof a=="string"&&(a=Geo.Format.XML.prototype.read.apply(this,[a]));var a=a.nodeName!=this.tagName?a.getElementsByTagName(this.tagName):[a],b={};a.length>0&&this.runChildNodes(b,a[0]);return b},runChildNodes:function(a,b,c){for(var b=b.childNodes,d,e,f=0;f<b.length;++f)d=b[f],d.nodeType==1&&(e=c?this["read_"+c+"_"+d.nodeName]:this["read_"+d.nodeName])&&e.apply(this,[a,d])},read_Service:function(a,
b){var c={};this.runChildNodes(c,b,"Service");a.service=c},read_Service_Name:function(a,b){var c=this.getChildValue(b);if(c)a.name=c},read_Service_Title:function(a,b){var c=this.getChildValue(b);if(c)a.title=c},read_Service_Abstract:function(a,b){var c=this.getChildValue(b);if(c)a.serviceAbstract=c},read_Service_KeywordList:function(){},read_Service_OnlineResource:function(a,b){var c=this.getChildValue(b);if(a)a.onlineResource=c},read_Capability:function(a,b){var c={};this.runChildNodes(c,b,"Capability");
a.capability=c},read_Capability_Request:function(a,b){var c={};this.runChildNodes(c,b,"Capability_Request");a.request=c},read_Capability_Request_GetCapabilities:function(a,b){var c=b.getElementsByTagName("HTTP"),d={};c[0]&&this.runChildNodes(d,c[0],"Capability_Request_GetCapabilities_DCPType_HTTP");a.getCapabilities=d},read_Capability_Request_GetCapabilities_DCPType_HTTP_Get:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.getUrl=c},read_Capability_Request_GetCapabilities_DCPType_HTTP_Post:function(a,
b){var c=b.getAttribute("onlineResource");if(c)a.postUrl=c},read_Capability_Request_queryStation:function(a,b){var c=b.getElementsByTagName("HTTP"),d={};c[0]&&this.runChildNodes(d,c[0],"Capability_Request_queryStation_DCPType_HTTP");a.queryStation=d},read_Capability_Request_queryStation_DCPType_HTTP_Get:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.getUrl=c},read_Capability_Request_queryStation_DCPType_HTTP_Post:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.postUrl=c},
read_Capability_Request_queryLine:function(a,b){var c=b.getElementsByTagName("HTTP"),d={};c[0]&&this.runChildNodes(d,c[0],"Capability_Request_queryLine_DCPType_HTTP");a.queryLine=d},read_Capability_Request_queryLine_DCPType_HTTP_Get:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.getUrl=c},read_Capability_Request_queryLine_DCPType_HTTP_Post:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.postUrl=c},read_Capability_Request_queryChange:function(a,b){var c=b.getElementsByTagName("HTTP"),
d={};c[0]&&this.runChildNodes(d,c[0],"Capability_Request_queryChange_DCPType_HTTP")},read_Capability_Request_queryChange_DCPType_HTTP_Get:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.getUrl=c},read_Capability_Request_queryChange_DCPType_HTTP_Post:function(a,b){var c=b.getAttribute("onlineResource");if(c)a.postUrl=c},read_Capability_Networks:function(a,b){for(var c=b.getElementsByTagName("Name"),d=[],e=0;e<c.length;e++){var f=this.getChildValue(c[e]);f&&d.push(f)}a.networks=d},CLASS_NAME:"Geo.Util.Format.BusCapabilities"});
Geo.Util.Format.GlobeTileCapabilities=Geo.Class(Geo.Format.XML,{tagName:"ServiceCapabilities",read:function(a){typeof a=="string"&&(a=Geo.Format.XML.prototype.read.apply(this,[a]));var a=a.nodeName!=this.tagName?a.getElementsByTagName(this.tagName):[a],b=null;a.length>0&&(b={},this.runChildNodes(b,a[0],"capabilities"));return b},runChildNodes:function(a,b,c){for(var b=b.childNodes,d,e,f=0;f<b.length;++f)d=b[f],d.nodeType==1&&(e=this["read_"+c+"_"+d.nodeName])&&e.apply(this,[a,d])},read_capabilities_Name:function(a,
b){var c=this.getChildValue(b);if(c)a.name=c},read_capabilities_Service:function(a,b){var c=this.getChildValue(b);if(c)a.service=c},read_capabilities_Version:function(a,b){var c=this.getChildValue(b);if(c)a.version=c},read_capabilities_Abstract:function(a,b){var c=this.getChildValue(b);if(c)a.abstractValue=c},read_capabilities_ServerAddress:function(a,b){var c=this.getChildValue(b);if(c)a.serverAddress=c},read_capabilities_Data:function(a,b){var c=b.getElementsByTagName("TileData");c.length>0&&this.read_capabilities_Data_TileData(a,
c[0])},read_capabilities_Data_TileData:function(a,b){var c={};this.runChildNodes(c,b,"capabilities_Data_TileData");a.tileData=c},read_capabilities_Data_TileData_Tile:function(a,b){var c=this.getChildValue(b);if(c)a.tile=c},read_capabilities_Data_TileData_CRS:function(a,b){var c=this.getChildValue(b);if(c)a.crs=c},read_capabilities_Data_TileData_BoundBox:function(a,b){var c=new Geo.Bounds(parseFloat(b.getAttribute("minx")),parseFloat(b.getAttribute("miny")),parseFloat(b.getAttribute("maxx")),parseFloat(b.getAttribute("maxy")));
a.boundBox=c},read_capabilities_Data_TileData_LevelZeroTileSizeX:function(a,b){var c=this.getChildValue(b);if(c)a.levelZeroTileSizeX=parseInt(c)},read_capabilities_Data_TileData_LevelZeroTileSizeY:function(a,b){var c=this.getChildValue(b);if(c)a.levelZeroTileSizeY=parseInt(c)},read_capabilities_Data_TileData_TopLevel:function(a,b){var c=this.getChildValue(b);if(c)a.topLevel=parseInt(c)},read_capabilities_Data_TileData_BottomLevel:function(a,b){var c=this.getChildValue(b);if(c)a.bottomLevel=parseInt(c)},
read_capabilities_Data_TileData_TileVersionTime:function(a,b){var c=this.getChildValue(b);if(c){if(!a.tileVerstionTime)a.tileVerstionTime=[];a.tileVerstionTime.push(c)}},read_capabilities_Data_TileData_TilePixelsX:function(a,b){var c=this.getChildValue(b);if(c)a.tilePixelsX=parseInt(c)},read_capabilities_Data_TileData_TilePixelsY:function(a,b){var c=this.getChildValue(b);if(c)a.tilePixelsY=parseInt(c)},read_capabilities_Data_TileData_CacheExpireTime:function(a,b){var c=this.getChildValue(b);if(c)a.cacheExpireTime=
parseInt(c)},read_capabilities_Data_TileData_Pyramid:function(a,b){var c=(new Geo.Util.Format.Pyramid).read(b);a.pyramid=c},CLASS_NAME:"Geo.Util.Format.GlobeTileCapabilities"});
Geo.Util.Format.Pyramid=Geo.Class(Geo.Format.XML,{tagName:"Pyramid",read:function(a){typeof a=="string"&&(a=Geo.Format.XML.prototype.read.apply(this,[a]));var a=a.nodeName!=this.tagName?a.getElementsByTagName(this.tagName):[a],b={};a.length>0&&this.runChildNodes(b,a[0]);return b},runChildNodes:function(a,b){for(var c=b.childNodes,d,e,f=0;f<c.length;++f)d=c[f],d.nodeType==1&&(e=this["read_Pyramid_"+d.nodeName])&&e.apply(this,[a,d])},read_Pyramid_Basic:function(a,b){var c={name:b.getAttribute("Name"),
pyramidID:b.getAttribute("PyramidID"),description:b.getAttribute("Description")};OpenLayers.Util.extend(a,c)},read_Pyramid_Level:function(a,b){var c={topLevelIndex:parseInt(b.getAttribute("TopLevelIndex")),bottomLevelIndex:parseInt(b.getAttribute("BottomLevelIndex")),scaleX:parseInt(b.getAttribute("ScaleX")),scaleY:parseInt(b.getAttribute("ScaleY"))};OpenLayers.Util.extend(a,c)},read_Pyramid_TileBasic:function(a,b){var c={tileSizeX:parseFloat(b.getAttribute("TileSizeX")),tileSizeY:parseFloat(b.getAttribute("TileSizeY")),
originRowIndex:parseInt(b.getAttribute("OriginRowIndex")),originColIndex:parseInt(b.getAttribute("OriginColIndex"))};OpenLayers.Util.extend(a,c)},read_Pyramid_TopTile:function(a,b){var c={fromX:parseInt(b.getAttribute("FromX")),fromY:parseInt(b.getAttribute("FromY")),toX:parseInt(b.getAttribute("ToX")),toY:parseInt(b.getAttribute("ToY"))};OpenLayers.Util.extend(a,c)},read_Pyramid_Range:function(a,b){var c={xmin:parseInt(b.getAttribute("XMin")),xmax:parseInt(b.getAttribute("XMax")),ymin:parseInt(b.getAttribute("YMin")),
ymax:parseInt(b.getAttribute("YMax"))};OpenLayers.Util.extend(a,c)},CLASS_NAME:"Geo.Util.Format.Pyramid"});
Geo.Util.Format.XML2JSON=Geo.Class({initialize:function(){},read:function(a,b,c){b||(b="");a=a.replace(/\s*\/>/g,"/>");a=a.replace(/<\?[^>]*>/g,"").replace(/<\![^>]*>/g,"");b.sort||(b=b.split(","));for(var a=this.no_fast_endings(a),a=this.attris_to_tags(a),a=escape(a),a=a.split("%3C").join("<").split("%3E").join(">").split("%3D").join("=").split("%22").join('"'),d=0;d<b.length;d++)a=a.replace(RegExp("<"+b[d]+">","g"),"*$**"+b[d]+"**$*"),a=a.replace(RegExp("</"+b[d]+">","g"),"*$***"+b[d]+"**$*");this.xmlobject=
{};b=this.xml_to_object("<JSONTAGWRAPPER>"+a+"</JSONTAGWRAPPER>").JSONTAGWRAPPER;c&&(b=this.show_json_structure(b,c));return b},xml_to_object:function(a){for(var b=a.replace(/<\//g,"\ufffd"),b=b.split("<"),a=[],c=0,d=[],e=1;e<b.length;e++){var f=b[e].split(">")[0];d.push(f);c++;for(a.push(c+"<"+b[e].split("\ufffd")[0]);b[e].indexOf("\ufffd"+d[d.length-1]+">")>=0;)c--,d.pop()}for(var g=-1,b="this.xmlobject",e=0;e<a.length;e++){var c="",d=a[e].split("<")[0],h=a[e].split("<")[1].split(">")[0],h=h.replace(/%3A/,
"_"),f=a[e].split(">")[1];if(d<=g)for(var g=g-d+1,i=0;i<g;i++)b=b.substring(0,b.lastIndexOf("."));b+="."+h;g=b.substring(0,b.lastIndexOf("."));eval("typeof "+g)!="object"&&(c+=g+"={value:"+g+"};\n");i=b.substring(b.lastIndexOf(".")+1);h=!1;for(k in eval(g))k==i&&(h=!0);g=!0;for(i=0;i<f.length;i+=3)f.charAt(i)!="%"&&(g=!1);f!=""&&!g?f/1!=f&&(f="'"+f.replace(/\'/g,"\\'")+"'",f=f.replace(/\*\$\*\*\*/g,"</"),f=f.replace(/\*\$\*\*/g,"<"),f=f.replace(/\*\*\$\*/g,">")):f="{}";f.charAt(0)=="'"&&(f="unescape("+
f+")");h&&!eval(b+".sort")&&(c+=b+"=["+b+"];\n");g="=";after="";h&&(g=".push(",after=")");eval(c+b+g+f+after);eval(b+".sort")&&(b+="["+eval(b+".length-1")+"]");g=d}return this.xmlobject},show_json_structure:function(a,b,c){var d="";d+=a.sort?"[\n":"{\n";for(var e in a)a.sort||(d+=e+":"),d+=typeof a[e]=="object"?this.show_json_structure(a[e],!1,1):typeof a[e]=="function"?a[e]+"":typeof a[e]!="string"?a[e]+",\n":"'"+a[e].replace(/\'/g,"\\'").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r")+
"',\n";d+=a.sort?"],\n":"},\n";if(!c){d=d.substring(0,d.lastIndexOf(","));d=d.replace(RegExp(",\n}","g"),"\n}");d=d.replace(RegExp(",\n]","g"),"\n]");a=d.split("\n");d="";for(e=c=0;e<a.length;e++){(a[e].indexOf("}")>=0||a[e].indexOf("]")>=0)&&c--;tabs="";for(var f=0;f<c;f++)tabs+="\t";d+=tabs+a[e]+"\n";(a[e].indexOf("{")>=0||a[e].indexOf("[")>=0)&&c++}b=="html"&&(d=d.replace(/</g,"&lt;").replace(/>/g,"&gt;"),d=d.replace(/\n/g,"<BR>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"));b=="compact"&&(d=d.replace(/\n/g,
"").replace(/\t/g,""))}return d},no_fast_endings:function(a){for(var a=a.split("/>"),b=1;b<a.length;b++){var c=a[b-1].substring(a[b-1].lastIndexOf("<")+1).split(" ")[0];a[b]="></"+c+">"+a[b]}return a=a.join("")},attris_to_tags:function(a){for(var b=" =\"'".split(""),a=a.split(">"),c=0;c<a.length;c++){for(var d=a[c].split("<"),e=0;e<4;e++)d[0]=d[0].replace(RegExp(b[e],"g"),"_jsonconvtemp"+e+"_");if(d[1]){d[1]=d[1].replace(/'/g,'"');d[1]=d[1].split('"');for(var f=1;f<d[1].length;f+=2)for(e=0;e<4;e++)d[1][f]=
d[1][f].replace(RegExp(b[e],"g"),"_jsonconvtemp"+e+"_");d[1]=d[1].join('"')}a[c]=d.join("<")}a=a.join(">");a=a.replace(/ ([^=]*)=([^ |>]*)/g,"><$1>$2</$1");a=a.replace(/>"/g,">").replace(/"</g,"<");for(e=0;e<4;e++)a=a.replace(RegExp("_jsonconvtemp"+e+"_","g"),b[e]);return a},CLASS_NAME:"Geo.Util.Format.XML2JSON"});
Geo.View2D.Map=Geo.Class(OpenLayers.Map,{pyramid:null,allOverlays:!1,layerGroup:null,EVENT_TYPES:["unloadLayerGroup","loadlayergroup"],overLayers:null,initialize:function(a,b){this.EVENT_TYPES=Geo.View2D.Map.prototype.EVENT_TYPES.concat(OpenLayers.Map.prototype.EVENT_TYPES);this.overLayers=[];b=b||{};this.controls=b.controls==null?[new Geo.View2D.Control.Navigation,new Geo.View2D.Control.PanZoomBar,new Geo.View2D.Control.ArgParser,new Geo.View2D.Control.MagnifyingGlass]:[];OpenLayers.Map.prototype.initialize.apply(this,
arguments);this.allOverlays=!1;this.pyramid=this.pyramid?this.pyramid:new Geo.Pyramid;this.setPyramid(this.pyramid)},addLayer:function(a,b){a.isBaseLayer=!1;OpenLayers.Map.prototype.addLayer.apply(this,arguments);b||(this.updateBaseLayer(),this.resetTopLayer())},addOverLayer:function(a){this.addLayer(a);this.overLayers.push(a)},removeLayer:function(a){OpenLayers.Util.removeItem(this.overLayers,a);OpenLayers.Map.prototype.removeLayer.apply(this,arguments)},raiseLayer:function(a,b){var c=this.getLayerIndex(a),
d=Math.abs(b);if(b>0)for(var e=this.layers.length;c<e;c++){if(d==0||e<=c+1)break;this.layers[c+1].displayInLayerSwitcher?d--:b++}else if(b<0)for(;c>=0;c--){if(d==0||c-1<0)break;this.layers[c-1].displayInLayerSwitcher?d--:b-=1}OpenLayers.Map.prototype.raiseLayer.apply(this,arguments)},resetTopLayer:function(){var a=this.layers.length,b=a-1;for(a-=1;a>=0;a--){var c=this.layers[a];c.isOnTop&&!c.isBaseLayer&&this.setLayerIndex(c,b--)}},resetOverLayer:function(){var a=this.layers.length,b=a-1;for(a-=1;a>=
0;a--){var c=this.layers[a];OpenLayers.Util.indexOf(this.overLayers,c)!=-1&&this.setLayerIndex(c,b--)}},setPyramid:function(a){a||(a=new Geo.Pyramid);this.pyramid=a;this.maxResolution=this.pyramid.getMaxResolution();this.minResolution=this.pyramid.getMinResolution();this.numZoomLevels=this.pyramid.getNumZoomLevels();this.maxExtent=this.pyramid.maxExtent.clone();this.updateBaseLayer({maxResolution:this.maxResolution,minResolution:this.minResolution,maxExtent:this.maxExtent})},updateBaseLayer:function(a){var b=
{};a?OpenLayers.Util.extend(b,a):b={maxResolution:this.getLayersMaxResolution(),minResolution:this.getLayersMinResolution(),maxExtent:this.getLayersMaxExtent()};OpenLayers.Util.extend(b,{displayInLayerSwitcher:!1,isBaseLayer:!0});a=new OpenLayers.Layer("GeoGlobeBaseLayer",b);this.baseLayer&&this.removeLayer(this.baseLayer);OpenLayers.Map.prototype.addLayer.apply(this,[a])},getLayersMaxResolution:function(){for(var a=this.layers,b=null,c=0;c<a.length;c++){var d=a[c].getOptions().maxResolution;!a[c].isBaseLayer&&
d&&(b=b?Math.max(b,d):d)}a=this.pyramid.getMaxResolution();return b<=0||b>a?a:b},getLayersMinResolution:function(){for(var a=this.layers,b=null,c=0;c<a.length;c++){var d=a[c].getOptions().minResolution;!a[c].isBaseLayer&&d&&(b=b?Math.min(b,d):d)}a=this.pyramid.getMinResolution();return b<=0||b<a?a:b},getLayersMaxExtent:function(){for(var a=null,b=this.layers,c=0;c<b.length;c++)!b[c].isBaseLayer&&b[c].maxExtent&&(a?a.extend(b[c].maxExtent):a=b[c].maxExtent.clone());b=this.pyramid.maxExtent.clone();
return a?a:b},loadLayerGroup:function(a){if(this.layerGroup==a)return OpenLayers.Console.warn("\u4e0d\u80fd\u91cd\u590d\u52a0\u8f7d\u56fe\u5c42\u7ec4\u5230\u5730\u56fe\u4e2d\uff01"),!1;this.unloadLayerGroup();a.setMap(this);this.layerGroup=a;this.updateBaseLayer();this.resetOverLayer();this.resetTopLayer();this.events.triggerEvent("loadlayergroup",{layerGroup:a,map:this})},unloadLayerGroup:function(){var a=this.layerGroup;if(!a)return!1;a.removeMap();this.layerGroup=null},CLASS_NAME:"Geo.View2D.Map"});
Geo.View2D.Layer.GlobeTile=Geo.Class(Geo.View2D.Layer.Grid,{alwaysInRange:!1,isBaseLayer:!1,topLevel:null,bottomLevel:null,pyramid:null,accessUrl:null,mirrorUrl:null,serviceName:null,verstionTime:"9999-01-01 00:00:00",cacheExpireTime:"now",buffer:0,transitionEffect:null,initialize:function(a,b,c){this.name=a;this.url=b;this.convertUrl(this.url);c||(c={});c.pyramid=c.pyramid?c.pyramid:new Geo.Pyramid;c.topLevel=c.topLevel?c.topLevel:c.pyramid.topLevelIndex;c.bottomLevel=c.bottomLevel?c.bottomLevel:
c.pyramid.bottomLevelIndex;c.pyramid.getMaxResolution();c.maxResolution=c.pyramid.getResolutionForLevel(c.topLevel);c.minResolution=c.pyramid.getResolutionForLevel(c.bottomLevel);c.tileSize=c.pyramid.tileSize;Geo.View2D.Layer.Grid.prototype.initialize.apply(this,[a,b,null,c])},convertUrl:function(a){var b=a.split("/services/");b[0]&&b[1]?(this.accessUrl=b[0]+"/DataServer",this.serviceName=b[1]):OpenLayers.Console.error("\u89e3\u6790GeoGlobe 2.0.0\u670d\u52a1\u5730\u5740\u9519\u8bef:"+a)},addTile:function(a,
b){return new Geo.View2D.Tile.Image(this,b,a,null,this.tileSize)},setVerstionTime:function(a){if(a)this.verstionTime=a,this.redraw()},getURL:function(a){OpenLayers.Util.getImagesLocation();a=this.adjustBounds(a);this.pyramid.getMaxResolution();var b,c,d;c=this.pyramid.getLevelForResolution(this.map.getResolution());b=this.pyramid.getTopTileSize().w/Math.pow(2,c);d=this.pyramid.topTileFromX<this.pyramid.topTileToX?Math.round((a.left-this.pyramid.topTileFromX)/b):Math.round((this.pyramid.topTileFromX-
a.right)/b);a=this.pyramid.topTileFromY<this.pyramid.topTileToY?Math.round((a.bottom-this.pyramid.topTileFromY)/b):Math.round((this.pyramid.topTileFromY-a.top)/b);if(d<0||a<0)return OpenLayers.Util.getImagesLocation()+"blank.gif";b="";var e={};if(this.mirrorUrl==null)b=this.accessUrl,e={T:this.serviceName,X:d,Y:a,L:c,INDATE:this.verstionTime};else{b=this.selectUrl(d,this.mirrorUrl);var f=b.split("/services/");f[0]&&f[1]&&(b=f[0]+"/DataServer",e={T:f[1],X:d,Y:a,L:c,INDATE:this.verstionTime})}return b=
this.getFullRequestString(e,b)},selectUrl:function(a,b){return b[a%b.length]},getDataExtent:function(){if(this.maxExtent)return this.maxExtent.clone()},clone:function(a){a==null&&(a=new Geo.View2D.Layer.GlobeTile(this.name,this.url,this.options));return a=Geo.View2D.Layer.Grid.prototype.clone.apply(this,[a])},CLASS_NAME:"Geo.View2D.Layer.GlobeTile"});
Geo.View2D.Layer.CWMS=Geo.Class(Geo.View2D.Layer.Grid,{layerId:null,mapStyleId:null,srid:null,sourceDate:null,formatSuffix:null,initialize:function(a,b,c){this.mapStyleId=c.mapStyleId;this.srid=c.srid;this.sourceDate=c.sourceDate;this.formatSuffix=c.formatSuffix||"png";Geo.View2D.Layer.Grid.prototype.initialize.apply(this,[a,b,null,c])},addTile:function(a,b){return new Geo.View2D.Tile.Image(this,b,a,null,this.tileSize)},getURL:function(a){var a=this.adjustBounds(a),b=this.map.getResolution(),c=Math.floor((a.left-
this.map.maxExtent.left)/(b*this.tileSize.w)),a=Math.floor((this.map.maxExtent.top-a.top)/(b*this.tileSize.h)),b=new Geo.Service.CWMS(this.name,this.url),d=this.map.pyramid.getLevelForResolution(this.map.getResolution());return b.getMap({layerId:this.layerId,mapStyleId:this.mapStyleId,srid:this.srid,sourceDate:this.sourceDate,level:d,col:c,row:a,formatSuffix:this.formatSuffix})},CLASS_NAME:"Geo.View2D.Layer.CWMS"});
Geo.View2D.BaseLayerGroup=Geo.Class({id:null,layers:null,map:null,initialize:function(a){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.layers=[];OpenLayers.Util.extend(this,a)},setMap:function(a){if(a&&!this.map){this.map=a;for(a=0;a<this.layers.length;a++)this.map.addLayer(this.layers[a],!0)}},removeMap:function(){if(this.map){for(var a=0;a<this.layers.length;a++)this.layers[a].map&&this.map.removeLayer(this.layers[a]);this.map=null}},getMaxResolution:function(){for(var a=this.layers,
b=null,c=0;c<a.length;c++)var d=a[c].getOptions().maxResolution,b=b==null?d:Math.max(b,d);return b},getMinResolution:function(){for(var a=this.layers,b=null,c=0;c<a.length;c++)var d=a[c].getOptions().minResolution,b=b==null?d:Math.min(b,d);return b},getMaxExtent:function(){for(var a=null,b=0;b<this.layers.length;b++)a?a.extend(this.layers[b].getDataExtent()):a=this.layers[b].getDataExtent();return a},destroy:function(){this.removeMap();for(var a=0;a<layers.length;a++)layers[a].destroy();this.layers=
null},CLASS_NAME:"Geo.View2D.BaseLayerGroup"});
Geo.View2D.BaseLayerGroup.getTianDiTuGroup=function(a){new Geo.Bounds(-180,-90,180,90);new Geo.Bounds(-180,-90,180,90);if(a={img:[new Geo.View2D.Layer.GlobeTile("\u5168\u7403\u5f71\u50cf\u5e95\u56fe(2-10)","http://tile0.tianditu.com/services/sbsm0210",{transitionEffect:"resize",topLevel:2,bottomLevel:10,maxExtent:new Geo.Bounds(-180,-90,180,90),mirrorUrl:["http://tile0.tianditu.com/services/sbsm0210","http://tile1.tianditu.com/services/sbsm0210","http://tile2.tianditu.com/services/sbsm0210","http://tile3.tianditu.com/services/sbsm0210",
"http://tile4.tianditu.com/services/sbsm0210","http://tile5.tianditu.com/services/sbsm0210","http://tile6.tianditu.com/services/sbsm0210","http://tile7.tianditu.com/services/sbsm0210"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u7403\u5f71\u50cf\u6ce8\u8bb0(2-10)","http://tile0.tianditu.com/services/A0104_ImgAnnoE",{topLevel:2,bottomLevel:10,maxExtent:new Geo.Bounds(-180,-90,180,90),mirrorUrl:["http://tile0.tianditu.com/services/A0610_ImgAnno","http://tile1.tianditu.com/services/A0610_ImgAnno","http://tile2.tianditu.com/services/A0610_ImgAnno",
"http://tile3.tianditu.com/services/A0610_ImgAnno","http://tile4.tianditu.com/services/A0610_ImgAnno","http://tile5.tianditu.com/services/A0610_ImgAnno","http://tile6.tianditu.com/services/A0610_ImgAnno","http://tile7.tianditu.com/services/A0610_ImgAnno"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(14)","http://tile0.tianditu.com/services/eastdawnall",{transitionEffect:"resize",topLevel:14,bottomLevel:14,maxExtent:new Geo.Bounds(73.30078125,17.9296875,135.17578125,53.701171875),mirrorUrl:["http://tile0.tianditu.com/services/eastdawnall",
"http://tile1.tianditu.com/services/eastdawnall","http://tile2.tianditu.com/services/eastdawnall","http://tile3.tianditu.com/services/eastdawnall","http://tile4.tianditu.com/services/eastdawnall","http://tile5.tianditu.com/services/eastdawnall","http://tile6.tianditu.com/services/eastdawnall","http://tile7.tianditu.com/services/eastdawnall"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u7403\u5f71\u50cf(15-18)","http://tile0.tianditu.com/services/sbsm1518",{transitionEffect:"resize",topLevel:15,bottomLevel:18,
maxExtent:new Geo.Bounds(-180,-90,180,90),mirrorUrl:["http://tile0.tianditu.com/services/sbsm1518","http://tile1.tianditu.com/services/sbsm1518","http://tile2.tianditu.com/services/sbsm1518","http://tile3.tianditu.com/services/sbsm1518","http://tile4.tianditu.com/services/sbsm1518","http://tile5.tianditu.com/services/sbsm1518","http://tile6.tianditu.com/services/sbsm1518","http://tile7.tianditu.com/services/sbsm1518"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(13)","http://tile0.tianditu.com/services/e13",
{transitionEffect:"resize",topLevel:13,bottomLevel:13,maxExtent:new Geo.Bounds(73.30078125,17.9736328125,135.1318359375,53.6572265625),mirrorUrl:["http://tile0.tianditu.com/services/e13","http://tile1.tianditu.com/services/e13","http://tile2.tianditu.com/services/e13","http://tile3.tianditu.com/services/e13","http://tile4.tianditu.com/services/e13","http://tile5.tianditu.com/services/e13","http://tile6.tianditu.com/services/e13","http://tile7.tianditu.com/services/e13"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(12)",
"http://tile0.tianditu.com/services/e12",{transitionEffect:"resize",topLevel:12,bottomLevel:12,maxExtent:new Geo.Bounds(73.30078125,17.9296875,135.17578125,53.701171875),mirrorUrl:["http://tile0.tianditu.com/services/e12","http://tile1.tianditu.com/services/e12","http://tile2.tianditu.com/services/e12","http://tile3.tianditu.com/services/e12","http://tile4.tianditu.com/services/e12","http://tile5.tianditu.com/services/e12","http://tile6.tianditu.com/services/e12","http://tile7.tianditu.com/services/e12"]}),
new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(11)","http://tile0.tianditu.com/services/e11",{transitionEffect:"resize",topLevel:11,bottomLevel:11,maxExtent:new Geo.Bounds(73.30078125,17.9296875,135.17578125,53.7890625),mirrorUrl:["http://tile0.tianditu.com/services/e11","http://tile1.tianditu.com/services/e11","http://tile2.tianditu.com/services/e11","http://tile3.tianditu.com/services/e11","http://tile4.tianditu.com/services/e11","http://tile5.tianditu.com/services/e11","http://tile6.tianditu.com/services/e11",
"http://tile7.tianditu.com/services/e11"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf\u6ce8\u8bb0(11-14)","http://tile0.tianditu.com/services/B0530_eImgAnno",{topLevel:11,bottomLevel:14,maxExtent:new Geo.Bounds(73.4765625,2.8125,135.439453125,53.7890625),mirrorUrl:["http://tile0.tianditu.com/services/B0530_eImgAnno","http://tile1.tianditu.com/services/B0530_eImgAnno","http://tile2.tianditu.com/services/B0530_eImgAnno","http://tile3.tianditu.com/services/B0530_eImgAnno","http://tile4.tianditu.com/services/B0530_eImgAnno",
"http://tile5.tianditu.com/services/B0530_eImgAnno","http://tile6.tianditu.com/services/B0530_eImgAnno","http://tile7.tianditu.com/services/B0530_eImgAnno"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf\u6ce8\u8bb0(15-18)","http://tile0.tianditu.com/services/siweiAnno68",{topLevel:15,bottomLevel:18,maxExtent:new Geo.Bounds(73.4765625,2.8125,135.439453125,53.7890625),mirrorUrl:["http://tile0.tianditu.com/services/siweiAnno68","http://tile1.tianditu.com/services/siweiAnno68","http://tile2.tianditu.com/services/siweiAnno68",
"http://tile3.tianditu.com/services/siweiAnno68","http://tile4.tianditu.com/services/siweiAnno68","http://tile5.tianditu.com/services/siweiAnno68","http://tile6.tianditu.com/services/siweiAnno68","http://tile7.tianditu.com/services/siweiAnno68"]})],dlg:[new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf(2-10)","http://tile0.tianditu.com/services/A0512_EMap",{transitionEffect:"resize",topLevel:2,bottomLevel:10,maxExtent:new Geo.Bounds(-180,-90,180,90),mirrorUrl:["http://tile0.tianditu.com/services/A0512_EMap",
"http://tile1.tianditu.com/services/A0512_EMap","http://tile2.tianditu.com/services/A0512_EMap","http://tile3.tianditu.com/services/A0512_EMap","http://tile4.tianditu.com/services/A0512_EMap","http://tile5.tianditu.com/services/A0512_EMap","http://tile6.tianditu.com/services/A0512_EMap","http://tile7.tianditu.com/services/A0512_EMap"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf\u6ce8\u8bb0(2-10)","http://tile0.tianditu.com/services/AB0512_Anno",{topLevel:2,bottomLevel:10,maxExtent:new Geo.Bounds(-180,
-90,180,90),mirrorUrl:["http://tile0.tianditu.com/services/AB0512_Anno","http://tile1.tianditu.com/services/AB0512_Anno","http://tile2.tianditu.com/services/AB0512_Anno","http://tile3.tianditu.com/services/AB0512_Anno","http://tile4.tianditu.com/services/AB0512_Anno","http://tile5.tianditu.com/services/AB0512_Anno","http://tile6.tianditu.com/services/AB0512_Anno","http://tile7.tianditu.com/services/AB0512_Anno"]}),new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf(11-12)","http://tile0.tianditu.com/services/B0627_EMap1112",
{transitionEffect:"resize",topLevel:11,bottomLevel:12,maxExtent:new Geo.Bounds(69.9609375,0.87890625,879.9609375,56.25),mirrorUrl:["http://tile0.tianditu.com/services/B0627_EMap1112","http://tile1.tianditu.com/services/B0627_EMap1112","http://tile2.tianditu.com/services/B0627_EMap1112","http://tile3.tianditu.com/services/B0627_EMap1112","http://tile4.tianditu.com/services/B0627_EMap1112","http://tile5.tianditu.com/services/B0627_EMap1112","http://tile6.tianditu.com/services/B0627_EMap1112","http://tile7.tianditu.com/services/B0627_EMap1112"]}),
new Geo.View2D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf(13-18)","http://tile0.tianditu.com/services/siwei0608",{transitionEffect:"resize",topLevel:13,bottomLevel:18,maxExtent:new Geo.Bounds(-180,-90,180,90),mirrorUrl:["http://tile0.tianditu.com/services/siwei0608","http://tile1.tianditu.com/services/siwei0608","http://tile2.tianditu.com/services/siwei0608","http://tile3.tianditu.com/services/siwei0608","http://tile4.tianditu.com/services/siwei0608","http://tile5.tianditu.com/services/siwei0608",
"http://tile6.tianditu.com/services/siwei0608","http://tile7.tianditu.com/services/siwei0608"]})]}[a])return new Geo.View2D.BaseLayerGroup({layers:a});return null};Geo.View2D.LayerGroup=Geo.View2D.BaseLayerGroup;
Geo.View2D.FeatureManager=Geo.Class({id:null,map:null,_typeMapping:null,featureSortField:"featureSort",orderNumberField:"orderNumber",styleMap:null,vectorLayerOptions:null,vectorLayer:null,selectControlOptions:null,selectControl:null,maxFeaturesPerPage:15,topicCSSClass:null,topicDiv:null,initialize:function(a){this._typeMapping={};this.styleMap=Geo.View2D.FeatureManager.defaultStyleMap;this.registerResultType("default");OpenLayers.Util.extend(this,a)},setMap:function(a){if(a&&!this.map)this.map=a,
this.vectorLayer=new OpenLayers.Layer.Vector("GeoGlobeFeatureManagerVector",{styleMap:this.styleMap,isOnTop:!0,displayInLayerSwitcher:!1,rendererOptions:{zIndexing:!0}}),this.map.addLayer(this.vectorLayer),this._initSelectControl(),this._addTopicDiv()},registerFeatureSort:function(a,b){this._typeMapping[a]=OpenLayers.Util.extend({features:[],currentPage:0,maxFeaturesPerPage:this.maxFeaturesPerPage,onTurnToPage:this.onTurnToPage,onFeatureSelect:Geo.View2D.FeatureManager.showFramedCloud,onFeatureUnselect:Geo.View2D.FeatureManager.closeFramedCloud,
onFeatureOver:Geo.View2D.FeatureManager.showTopic,onFeatureOut:Geo.View2D.FeatureManager.closeTopic},b)},registerResultType:function(a,b){this.registerFeatureSort(a,b)},addFeatures:function(a,b,c){b=b||"default";a instanceof Array||(a=[a]);if(this._typeMapping[b]){var a=this._addTypeMarker(a,b),d=this._typeMapping[b].style;d&&this._addStyleForFeatures(a,d);c?this._typeMapping[b].features.concat(a):(this.clearResultFromMap(b),this._typeMapping[b].features=a);this._typeMapping[b].currentPage=0}},onTurnToPage:function(){},
turnToPageN:function(a,b){var b=b||"default",c=this._typeMapping[b],d=this.getTotalPageNumber(b),a=a<=0?1:a,a=a>d?d:a,d=this._pagingFeatures({maxPerPage:c.maxFeaturesPerPage,pageNum:a,resultArr:c.features});this.addOrderForFeatures(d);if(a!==c.currentPage)this.clearResultFromMap(b),this.drawFeaturesToMap(d),c.currentPage=a;c.onTurnToPage(d);return d},turnToFirst:function(a,b){return this.turnToPageN(1,a||"default",b)},turnToNext:function(a,b){a=a||"default";return this.turnToPageN(this._typeMapping[a].currentPage+
1,a,b)},turnToPre:function(a,b){a=a||"default";return this.turnToPageN(this._typeMapping[a].currentPage-1,a,b)},turnToLast:function(a,b){a=a||"default";this.turnToPageN(this.getTotalPageNumber(a),a,b)},getPageInfo:function(a){a=this._typeMapping[a||"default"];return Math.ceil(a.features.length/a.maxFeaturesPerPage)},getTotalPageNumber:function(a){a=this._typeMapping[a||"default"];return Math.ceil(a.features.length/a.maxFeaturesPerPage)},getFeatures:function(a){return this._typeMapping[a||"default"].features},
drawFeaturesToMap:function(a){var b,c,d;b=this.map;c=this.vectorLayer;if(typeof a=="string"){var e=a||"default";this._typeMapping[e]&&b&&(d=this.getFeatures(e))}a instanceof Array&&(d=a);c.addFeatures(d);(a=c.getDataExtent())&&c.map.zoomToExtent(a)},selectFeatureById:function(a){this.selectControl.unselectAll();a=this.vectorLayer.getFeatureById(a);this.vectorLayer.drawFeature(a);this.selectControl.select(a);a.selectControl=this.selectControl},clearFeatureFromMap:function(a){var a=a||"default",b=this._typeMapping[a],
c=this.vectorLayer,a=a=="allType"?this.vectorLayer.features:b?b.features:[];c&&(this.selectControl.unselectAll(),c.removeFeatures(a))},clearResultFromMap:function(a){this.clearFeatureFromMap(a)},clearFeatures:function(a){var a=a||"default",b=this._typeMapping[a];if(b)this.clearResultFromMap(a),b.features=[]},clearResult:function(a){this.clearFeatures(a)},addOrderForFeatures:function(a){for(var b=0;b<a.length;b++)a[b].attributes[this.orderNumberField]=b;return a},_addStyleForFeatures:function(a,b){for(var c=
0;c<a.length;c++){var d=a[c];if(!d.style)d.style=b}},_addTypeMarker:function(a,b){for(var c=0;c<a.length;c++)a[c].attributes[this.featureSortField]=b;return a},_addTopicDiv:function(){var a=OpenLayers.Util.getElement(this.map.id+"featureManagerTopic");if(!a){a=document.createElement("div");if(!this.topicCSSClass)a.style.backgroundColor="#fff",a.style.border="1px solid #000",a.style.padding="3px",a.style.position="absolute",a.style.top="30px",a.style.left="30px",a.style.display="none",a.innerHTML=
"test";this.map.div.appendChild(a);this.topicDiv=a}},_pagingFeatures:function(a){var b=a.maxPerPage,c=a.pageNum;return a.resultArr.slice((c-1)*b,c*b-1+1)},_dispatchEvent:function(a,b,c){a._typeMapping[b.attributes[a.featureSortField]][c](b)},_initSelectControl:function(){if(this.map&&!this.selectControl){var a={onSelect:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureSelect")},this),onUnselect:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureUnselect")},
this),callbacks:{over:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureOver")},this),out:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureOut")},this)}},a=OpenLayers.Util.applyDefaults(this.selectControlOptions,a);this.selectControl=new Geo.View2D.Control.SelectFeature(this.vectorLayer,a);this.map.addControl(this.selectControl)}}});
Geo.View2D.FeatureManager.defaultStyleMap=new Geo.StyleMap({"default":new Geo.Style({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10,graphicYOffset:-12}),select:new Geo.Style({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker-blue.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10,graphicYOffset:-12})});
Geo.View2D.FeatureManager.showFramedCloud=function(a,b){var c=a.layer,d=c?c.map:null;if(c&&d){var c=b?b:function(){var b="",c;for(c in a.attributes)b+=c+":"+a.attributes[c]+"<br>";return b}(),e=null;"Geo.Geometry.LineString"==a.geometry.CLASS_NAME?(e=a.geometry.components[Math.floor(a.geometry.components.length/2)],e=new Geo.LonLat(e.x,e.y)):e=a.geometry.getBounds().getCenterLonLat();d&&d.setCenter(e);c=new Geo.View2D.Popup.FramedCloud("featureInfo",e,null,c,null,!0,Geo.View2D.FeatureManager.onPopupClose);
a.popup=c;c.feature=a;if(this.selectControl)a.selectControl=this.selectControl;d.addPopup(c)}};Geo.View2D.FeatureManager.closeFramedCloud=function(a){var b=a.layer,c=b?b.map:null;if(a.popup&&b&&c)c.removePopup(a.popup),a.popup.destroy(),a.popup=null};Geo.View2D.FeatureManager.onPopupClose=function(){if(this.feature&&this.feature.selectControl)this.feature.selectControl.unselect(this.feature);else{var a=this.map;a&&a.removePopup(this)}};Geo.View2D.FeatureManager.showTopic=function(){};
Geo.View2D.FeatureManager.closeTopic=function(){};Geo.View2D.Control.DrawCircle=Geo.Class(Geo.View2D.Control,{type:Geo.View2D.Control.TYPE_TOOL,sides:40,persist:!1,initialize:function(a){Geo.View2D.Control.prototype.initialize.apply(this,[a]);this.handler=new OpenLayers.Handler.RegularPolygon(this,{done:this.done},{sides:this.sides,persist:this.persist})},done:function(){}});
Geo.View2D.Control.DrawPath=Geo.Class(Geo.View2D.Control,{type:Geo.View2D.Control.TYPE_TOOL,persist:!1,initialize:function(a){Geo.View2D.Control.prototype.initialize.apply(this,[a]);this.handler=new OpenLayers.Handler.Path(this,{done:this.done},{persist:this.persist})},done:function(){}});
Geo.View2D.Control.DrawPoint=Geo.Class(Geo.View2D.Control,{type:Geo.View2D.Control.TYPE_TOOL,persist:!1,initialize:function(a){Geo.View2D.Control.prototype.initialize.apply(this,[a]);this.handler=new OpenLayers.Handler.Point(this,{done:this.done},{persist:this.persist})},done:function(){}});
Geo.View2D.Control.DrawPolygon=Geo.Class(Geo.View2D.Control,{type:Geo.View2D.Control.TYPE_TOOL,persist:!1,initialize:function(a){Geo.View2D.Control.prototype.initialize.apply(this,[a]);this.handler=new OpenLayers.Handler.Polygon(this,{done:this.done})},done:function(){}});
Geo.View2D.Control.DrawRectangle=Geo.Class(Geo.View2D.Control,{type:Geo.View2D.Control.TYPE_TOOL,persist:!1,initialize:function(a){Geo.View2D.Control.prototype.initialize.apply(this,[a]);this.handler=new OpenLayers.Handler.RegularPolygon(this,{done:this.done},{irregular:!0,persist:this.persist})},done:function(){}});
Geo.View2D.Control.MagnifyingGlass=Geo.Class(Geo.View2D.Control,{autoActivate:!0,initialize:function(){Geo.View2D.Control.prototype.initialize.apply(this,arguments)},draw:function(){Geo.View2D.Control.prototype.draw.apply(this,arguments);this.handler=new Geo.View2D.Handler.MouseWheel(this,{down:this.magnifyingglassZoomOut,up:this.magnifyingglassZoomIn});this.initDiv()},initDiv:function(){var a=OpenLayers.Util.createDiv("map_magnifyingglass");a.style.borderRight="medium none";a.style.borderTop="medium none";
a.style.borderLeft="medium none";a.style.borderBottom="medium none";a.style.width="111px";a.style.height="74px";a.style.display="none";a.style.unselectable="on";var b=OpenLayers.Util.createDiv();b.style.lineHeight="1px";b.style.width="4px";b.style.height="4px";b.style.left="0";var c=OpenLayers.Util.createDiv();c.style.lineHeight="1px";c.style.width="4px";c.style.height="4px";c.style.right="0";var d=OpenLayers.Util.createDiv();d.style.lineHeight="1px";d.style.width="4px";d.style.height="4px";d.style.right=
"0";d.style.top="40px";var e=OpenLayers.Util.createDiv();e.style.lineHeight="1px";e.style.width="4px";e.style.height="4px";e.style.left="0";e.style.top="40px";a.appendChild(b);a.appendChild(c);a.appendChild(d);a.appendChild(e);this.map.viewPortDiv.appendChild(a)},bw_out:null,bw_in:null,variable:1,getTimeout:function(a,b,c){return window.setTimeout(function(){b.apply(a)},c)},magnifyingglassZoomOut:function(a){if(this.variable==1){var b=OpenLayers.Util.getElement("map_magnifyingglass");if(b)b.style.width=
111,b.style.height=74,this.evt=a,this.out()}},magnifyingglassZoomIn:function(a){if(this.variable==1){var b=OpenLayers.Util.getElement("map_magnifyingglass");if(b)b.style.width="27px",b.style.height="24px",this.evt=a,this.in_()}},out:function(){this.Rx1(!0)},in_:function(){this.Rx1(!1)},Rx1:function(a){var b=OpenLayers.Util.getElement("map_magnifyingglass");if(this.variable<=4){if(b){var c=1,d;if(a){d=parseInt(b.style.width);obj_h=parseInt(b.style.height);c*=15;if(d>=30){if(d&&c)b.style.width=Math.abs(d-
(c+6))+"px";if(obj_h>=25&&obj_h&&c)b.style.height=Math.abs(obj_h-c)+"px";b.style.left=this.evt.xy.x-parseInt(b.style.width)/2+"px";b.style.top=this.evt.xy.y-parseInt(b.style.height)/2+"px";b.childNodes[0].style.borderWidth="0px 2px 2px 0px";b.childNodes[0].style.borderStyle="solid";b.childNodes[0].style.borderColor="red";b.childNodes[1].style.borderWidth="0px 0px 2px 2px";b.childNodes[1].style.borderStyle="solid";b.childNodes[1].style.borderColor="red";b.childNodes[2].style.borderWidth="2px 0px 0px 2px";
b.childNodes[2].style.borderStyle="solid";b.childNodes[2].style.borderColor="red";b.childNodes[3].style.borderWidth="2px 2px 0px 0px";b.childNodes[3].style.borderStyle="solid";b.childNodes[3].style.borderColor="red";b.childNodes[2].style.top=b.style.height;b.childNodes[3].style.top=b.style.height;b.style.display="";b.style.zIndex=1010}this.variable++;this.bw_out=this.getTimeout(this,a?this.out:this.in_,60)}else{d=parseInt(b.style.width);obj_h=parseInt(b.style.height);c*=15;if(d<=111){b.style.width=
Math.abs(d+c)+"px";if(obj_h<=64)b.style.height=Math.abs(obj_h+c)+"px";b.style.left=this.evt.xy.x-parseInt(b.style.width)/2+"px";b.style.top=this.evt.xy.y-parseInt(b.style.height)/2+"px";b.childNodes[0].style.borderWidth="2px 0px 0px 2px";b.childNodes[0].style.borderStyle="solid";b.childNodes[0].style.borderColor="red";b.childNodes[1].style.borderWidth="2px 2px 0px 0px";b.childNodes[1].style.borderStyle="solid";b.childNodes[1].style.borderColor="red";b.childNodes[2].style.borderWidth="0px 2px 2px 0px";
b.childNodes[2].style.borderStyle="solid";b.childNodes[2].style.borderColor="red";b.childNodes[3].style.borderWidth="0px 0px 2px 2px";b.childNodes[3].style.borderStyle="solid";b.childNodes[3].style.borderColor="red";b.childNodes[2].style.top=b.style.height;b.childNodes[3].style.top=b.style.height;b.style.display="";b.style.zIndex=1010}this.variable++;this.bw_in=this.getTimeout(this,a?this.out:this.in_,100)}}}else a?(window.clearTimeout(this.bw_out),this.bw_out=null):(window.clearTimeout(this.bw_in),
this.bw_in=null),this.variable=1,b.style.display="none",b.style.zIndex=0,b.style.width="111px",b.style.height="74px"}});
Geo.View2D.Control.GeoOverviewMap=Geo.Class(Geo.View2D.Control.OverviewMap,{initialize:function(a){a=a||{};if(a.layers&&a.layers.length>0){for(var b=0,c=a.layers.length;b<c;b++)a.layers[b].isBaseLayer=!1;b=new Geo.View2D.Layer("GeoGlobeBaseLayer",{displayInLayerSwitcher:!1,isBaseLayer:!0});a.layers.push(b)}Geo.View2D.Control.OverviewMap.prototype.initialize.apply(this,[a])},draw:function(){return Geo.View2D.Control.OverviewMap.prototype.draw.apply(this,arguments)},createMap:function(){Geo.View2D.Control.OverviewMap.prototype.createMap.apply(this,
arguments);this.layers.length==1?(this.map&&this.map.layerGroup&&this._loadLayers(this.map),this.map.events.on({loadlayergroup:function(a){this._unloadLayers(a);this._loadLayers(a)},scope:this})):this.layers.length>1&&this._updateBaseLayer(this.map)},_loadLayers:function(a){this.layers=[];for(var b=a.layerGroup.layers,c=0;c<b.length;c++)this.layers.push(b[c].clone());this.ovmap.addLayers(this.layers);this._updateBaseLayer(a)},_updateBaseLayer:function(a){var b=this.ovmap;if(a.baseLayer){for(var a=
a.baseLayer.clone(),c=0,d=this.layers.length;c<d;c++)this.layers[c].baseLayer&&OpenLayers.Util.removeItem(this.layers,this.layers[c]);this.layers.push(a);b.baseLayer&&b.removeLayer(b.baseLayer);b.addLayer(a)}},_unloadLayers:function(){for(var a=this.ovmap,b=a.layers,c=[],d=0,e=b.length;d<e;d++)b[d].isBaseLayer||c.push(b[d]);d=0;for(e=c.length;d<e;d++)a.removeLayer(c[d])},destroy:function(){this.map.events.un({loadlayergroup:this.loadLayerGroup,scope:this});Geo.View2D.Control.OverviewMap.prototype.destroy.apply(this,
arguments)}});
Geo.View3D.Map=Geo.Class({id:null,div:null,activexObj:null,layers:null,overLayers:null,controls:null,popups:null,handlers:null,_auxStatus:null,zoomRatio:1,EVENT_TYPES:["unloadLayerGroup","loadlayergroup"],events:null,initialize:function(a,b){this.div=typeof a=="string"?document.getElementById(a):a;this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME);var c=Geo.View3D.Map.getActivex(this.id+"_Activex");this.activexObj=c.obj;if(!this.activexObj||c.version<Geo.View3D.Map.ACTIVEX_DEFAULT_VERSION)this.div.innerHTML=Geo.View3D.Map.activexErrorInfo;
else{this.div.appendChild(this.activexObj);this.setScenario("no server",2);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:!0});this.layers=[];this.overLayers=[];this.handlers=[];this.popups=[];this._auxStatus={latLongGrid:!1,compass:!0,coodInfo:!0,atmosphere:!0,crossHair:!0};this._initGeoRaster();this.activexObj.attachEvent("GGMeasureEvent",OpenLayers.Function.bind(function(a){this._measureHandler(a)},this));this.activexObj.attachEvent("EmitMouseEvent",
OpenLayers.Function.bind(function(a){this._mouseEventHandler(a)},this));this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(this.controls==null)this.controls=Geo.View3D.Control!=null?[new Geo.View3D.Control.KeyboardDefaults]:[];for(var c=0,d=this.controls.length;c<d;c++)this.addControlToMap(this.controls[c]);b={fontColor:16711680};this.setCoodInfo(b)}},zoomIn:function(){this.zoom(this.zoomRatio)},zoomOut:function(){this.zoom(-this.zoomRatio)},
zoom:function(a){this.activexObj.GetCameraWrapper().Zoom(a?a:1)},panTo:function(a){if(a){var b=this.activexObj;b&&b.GetCameraWrapper().Pan(a.lat,a.lon)}},setCenter:function(a,b,c){this._gotoPosition({lon:a.lon,lat:a.lat,level:b},c||!1)},flyTo:function(a,b){this._gotoPosition({lon:a.lon,lat:a.lat,alt:b},!0)},zoomToExtent:function(a){if(a){var b=this.activexObj;b&&b.GetCameraWrapper().PointFlyToEx(a.right,a.top,a.left,a.bottom)}},_gotoPosition:function(a,b){var c=this.activexObj;if(c){var d=a.lon,e=
a.lat,f=a.level,g=typeof a.alt=="undefined"?Geo.View3D.Map.DEFAULT_ALT:a.alt,g=typeof f!="undefined"?Geo.View3D.Map.getZfromLevel(f):g;this.getAltitude()>=g&&f!=0&&this.getAltitude()<Geo.View3D.Map.getZfromLevel(f-1)&&(g=this.getAltitude());this.getAltitude()>=g&&f==0&&(g=this.getAltitude());b?c.getCamera().PointFlyTo(d,e,g):c.getCamera().PointGoto(d,e,g)}},addLayer:function(a){if(!a)return!1;for(var b=0,c=this.layers.length;b<c;b++)if(this.layers[b]==a)return a=OpenLayers.i18n("layerAlreadyAdded",
{layerName:a.name}),OpenLayers.Console.warn(a),!1;this.layers.push(a);a.setMap(this)},addLayers:function(a){a instanceof Array||(a=[a]);for(var b=0;b<a.length;b++)this.addLayer(a[b])},addOverLayer:function(a){this.addLayer(a);this.overLayers.push(a)},removeLayer:function(a){OpenLayers.Util.removeItem(this.overLayers,a);OpenLayers.Util.removeItem(this.layers,a);a.removeMap();a.map=null},getNumLayers:function(){return this.layers.length},getLayerIndex:function(a){return OpenLayers.Util.indexOf(this.layers,
a)},getLayer:function(a){for(var b=null,c=0,d=this.layers.length;c<d;c++){var e=this.layers[c];if(e.id==a){b=e;break}}return b},raiseLayer:function(a,b){var c=this.getLayerIndex(a),d=Math.abs(b);if(b>0)for(var e=this.layers.length;c<e;c++){if(d==0||e<=c+1)break;this.layers[c+1].displayInLayerSwitcher?d--:b++}else if(b<0)for(;c>=0;c--){if(d==0||c-1<0)break;this.layers[c-1].displayInLayerSwitcher?d--:b-=1}d=this.getLayerIndex(a)+b;this.setLayerIndex(a,d)},resetTopLayer:function(){var a=this.layers.length,
b=a-1;for(a-=1;a>=0;a--){var c=this.layers[a];c.isOnTop&&this.setLayerIndex(c,b--)}},resetOverLayer:function(){var a=this.layers.length,b=a-1;for(a-=1;a>=0;a--){var c=this.layers[a];OpenLayers.Util.indexOf(this.overLayers,c)!=-1&&this.setLayerIndex(c,b--)}},setLayerIndex:function(a,b){var c=this.getLayerIndex(a),d=null,e=null;c==0?e=this.layers[c+1]:c==this.layers.length-1?d=this.layers[c-1]:(d=this.layers[c-1],e=this.layers[c+1]);var f=null,g=null;if(d&&d._layerData)f=d._layerData,d._layerData instanceof
Array||(f=[d._layerData]);if(e&&e._layerData)g=e._layerData,e._layerData instanceof Array||(g=[e._layerData]);if(b<0)b=0;else if(b>this.layers.length)b=this.layers.length;if(c!=b&&(this.layers.splice(c,1),this.layers.splice(b,0,a),c-=b,d=a._layerData,f&&c>0&&(c+=f.length-1),g&&c<0&&(c-=g.length-1),d)){d instanceof Array||(d=[d]);for(f=0;f<Math.abs(c);f++)for(g=0;g<d.length;g++)c>0&&this._moveLayerUp(d[g]),c<0&&(a.isOnTop&&a._markerLayer&&this._moveLayerDown(a._markerLayer),this._moveLayerDown(d[d.length-
g-1]))}},loadLayerGroup:function(a){if(this.layerGroup==a)return msg="\u4e0d\u80fd\u91cd\u590d\u52a0\u8f7d\u56fe\u5c42\u7ec4\u5230\u5730\u56fe\u4e2d\uff01",OpenLayers.Console.warn(msg),!1;this.unloadLayerGroup();a.setMap(this);this.layerGroup=a;this.resetOverLayer();this.resetTopLayer();this.events.triggerEvent("loadlayergroup",{layerGroup:a,map:this})},unloadLayerGroup:function(){var a=this.layerGroup;if(!a)return!1;for(var b=a.layers,c=0;c<b.length;c++)this.removeLayer(b[c]);this.layerGroup=a.map=
null;this.events.triggerEvent("unloadLayerGroup",{layerGroup:a,map:this})},addControl:function(a){this.controls.push(a);this.addControlToMap(a)},addControls:function(a){for(var b=0,c=a.length;b<c;b++)this.addControl(a[b])},addControlToMap:function(a,b){a.setMap(this);a.draw(b);a.autoActivate&&a.activate()},getControl:function(){},removeControl:function(){},getLonLatFromPixel:function(){},getPixelFromLonLat:function(){},addPopup:function(a,b){if(b)for(var c=this.popups.length-1;c>=0;--c)this.removePopup(this.popups[c]);
a.map=this;this.popups.push(a);a.draw()},removePopup:function(a){if(!a)a=this.popups;for(var b=a.length-1;b>=0;b--)OpenLayers.Util.removeItem(this.popups,a[b]),a.map&&a._clear(),a.map=null},getAuxStatus:function(a){return a=="all"?this._auxStatus:this._auxStatus[a]},showScale:function(){},showLatLongGrid:function(a){var b=this.activexObj;if(b)auxTools=b.GetAuxTools(),auxTools.ShowLatLongGrid(a),this._auxStatus.latLongGrid=a},showCompass:function(a){var b=this.activexObj;if(b)auxTools=b.GetAuxTools(),
auxTools.ShowCompass(a),this._auxStatus.compass=a},showCoodInfo:function(a){var b=this.activexObj;if(b)auxTools=b.GetAuxTools(),auxTools.ShowCoodInfo(a),this._auxStatus.coodInfo=a},setCoodInfo:function(a){OpenLayers.Util.applyDefaults(a,{screenPosition:0,textAlignment:0,fontColor:255,fontName:"\u5b8b\u4f53",fontBold:!0,fontSize:14});this.activexObj.GetAuxTools().SetPositionInfoParam(a.screenPosition,a.textAlignment,a.fontColor,a.fontName,a.fontBold,a.fontSize)},showAtmosphere:function(a){var b=this.activexObj;
if(b)auxTools=b.GetAuxTools(),auxTools.ShowAtmosphere(a),this._auxStatus.atmosphere=a},showCrossHair:function(a){var b=this.activexObj;if(b)auxTools=b.GetAuxTools(),auxTools.ShowCrossHair(a),this._auxStatus.crossHair=a},setCompassPosition:function(a){var b=this.activexObj;if(b)switch(auxTools=b.GetAuxTools(),a){case "left":auxTools.SetCompassPosition(12);break;case "right":auxTools.SetCompassPosition(8)}},setExaggeration:function(a){var a=a<0?0:a,b=this.activexObj;b&&b.GetLayerBox().TerrainExaggeration(a>
5?5:a)},attachEvent:function(){},snapScreen:function(a,b,c){this.activexObj.GetAuxTools().SaveScene(a?a:"c:\\GeoGlobeSnap.bmp",b?b:500,c?c:500)},startRecord:function(){var a=this.activexObj;a&&a.StartRecord()},endRecord:function(a){var b=this.activexObj;b&&b.StopRecord(a)},resetNorth:function(){var a=this.activexObj;a&&a.GetCamera().SetNorth()},cameraRotation:function(a,b,c){var d=this.activexObj;d&&d.GetCameraWrapper().Rotate(a,b,c)},getZoom:function(){var a=this.getAltitude();return Geo.View3D.Map.getZoomfromAlt(Math.round(a))},
getCenter:function(){var a=this.activexObj.GetCameraWrapper();return new Geo.LonLat(a.Lontitude,a.Latitude)},getAltitude:function(){return this.activexObj.GetCamera().Altitude},setTasService:function(a){var b=this.activexObj;b&&b.SetTerrainAnalysisService(a)},setScenario:function(a){a&&this.activexObj.ConnectServer(a,2)},_initGeoRaster:function(){this._geoRaster=this.activexObj.CreateGeoRasterObj();this._geoRaster.GeoRasterType=1},_mouseEventHandler:function(a){for(var b=0;b<this.handlers.length;b++){var c=
this.handlers[b];c.active&&c.listener(a)}},_measureHandler:function(){},_addGlobeTileService:function(a){var b=this.activexObj;if(b)return a=b.GetLayerBox().GetNewServiceData(a),b.GetLayerBox().AddLayerData(a),a},_removeLayerData:function(a){var b=this.activexObj;b&&a&&(b.GetSceneGroup().RemoveLayer(a.LayerData),b.GetLayerBox().RemoveLayerData(a))},_drawGeometry:function(a){var b=this.activexObj;if(b){var c=this._geoRaster;c.GeoRasterType=1;c.CreateDrawingUnit(a.featureid,a.rastLayer);c.lGeoType=
a.type;var d=OpenLayers.Util.extend({},Geo.Feature.Vector.style["default"]),d=OpenLayers.Util.extend(d,a.style);switch(a.type){case 0:if(d.externalGraphic){var c=d.fontColor?this._convertColorValue(d.fontColor):16711680,e=d.fontSize?d.fontSize:12,f=d.fontFamily?d.fontFamily:"\u5b8b\u4f53",g=a.strPoints.split(" "),h=a.vectorLayerObj.id+"_marker",b=b.GetBookMarkBox();a.vectorLayerObj._markerLayer?b.AddEX(parseFloat(g[0]),parseFloat(g[1]),h,d.label,d.externalGraphic,a.featureid,c,e,f):a.vectorLayerObj._markerLayer=
b.AddEX(parseFloat(g[0]),parseFloat(g[1]),h,d.label,d.externalGraphic,a.featureid,c,e,f)}else c.geoSize=d.pointRadius,c.fAlphaValue=parseInt(255*d.strokeOpacity),c.lColor=this._convertColorValue(d.fillColor),c.AddSTRPoint(a.strPoints,a.type);break;case 1:c.geoSize=d.strokeWidth;c.fAlphaValue=parseInt(255*d.strokeOpacity);c.lColor=this._convertColorValue(d.strokeColor);c.AddSTRPoint(a.strPoints,a.type);break;case 2:c.geoSize=d.strokeWidth,c.fAlphaValue=parseInt(255*d.strokeOpacity),c.lColor=this._convertColorValue(d.strokeColor),
c.fAlphaValue=parseInt(255*d.fillOpacity),c.PolygonFillColor=this._convertColorValue(d.fillColor),c.AddSTRPoint(a.strPoints,a.type)}}},_delGeometryByName:function(a,b){this._geoRaster.DeleteDrawingUnitByName(a,b)},_delBookMark:function(a,b){var c=this.activexObj;c&&c.GetBookMarkBox().RemoveEX(a,b)},_removeVectorLayerData:function(a){var b=this.activexObj;b&&b.GetSceneGroup().RemoveLayer(a)},_moveLayerUp:function(a){var b=this.activexObj;b&&b.GetLayerBox().MoveLayerUp(a)},_moveLayerDown:function(a){var b=
this.activexObj;b&&b.GetLayerBox().MoveLayerDown(a)},_gotoLayer:function(a){var b=this.activexObj;a&&b&&b.GetCameraWrapper().GoToLayer(a)},_setLayerOpacity:function(a,b){var c=this.activexObj;c&&c.GetLayerBox().SetLayerTransDegree(a,b)},_addWMTSService:function(a,b){var c=this.activexObj;if(c){for(var d=c.GetLayerBox(),e=d.GetWmtsInfo(a),f=[],g=e.GetCount(),h=0;h<g;h++){var i=e.GetResByIndex(h);if(!b||i.Name==b)i=d.AddOneWmtsLayer(i,""),c.GetCameraWrapper().GoToLayer(i),f.push(i)}return f}},_addWMSService:function(a,
b){var c=b.split(",");if(b){var d=this.activexObj;if(d){for(var e=d.GetOGCBox(),f=e.GetWmsLayersInfo(a),g=[],h=0,i=f.GetWmsInfoCount();h<i;h++)for(var j=f.GetWmsInfoByIndex(h),l=0;l<c.length;l++)if(j.Name==c[l]){var m=e.ConSelecedLayers(!1,200,1,20,!0,255,"image/png",j);m.Name=j.Name;d.GetLayerBox().AddLayerData(m);g.push(m)}return g}}},_addWCSService:function(a){var b=this.activexObj;b&&b.GetOGCBox().ConnectWCS(a)},_convertColorValue:function(a){return new Number("0x00"+a.replace("#",""))},unloadDestroy:null,
destroy:function(){for(var a=this.layers.length-1;a>=0;a--)this.removeLayer(this.layers[a]);this.div.removeChild(this.activexObj);this.activexObj=null},getExtent:function(){var a=this.activexObj,b=a.GetCamera(),c=a.GetCameraWrapper(),a=c.Latitude,c=c.Lontitude,b=b.ViewRange;return new Geo.Bounds(c-b/4,a-b/4,c+b/4,a+b/4)},CLASS_NAME:"Geo.View3D.Map"});Geo.View3D.Map.DEFAULT_ALT=25E5;
Geo.View3D.Map.getActivex=function(a){var b="",c=null;try{c=document.createElement("object");c.classid="CLSID:16630F6A-3BAB-4532-9C71-F29E91DDA1B3";c.width="100%";c.height="100%";if(a)c.id=a;b=c.GetVersion()}catch(d){}return{obj:c,version:b}};Geo.View3D.Map.ACTIVEX_DEFAULT_VERSION="1.3.1.55185";Geo.View3D.Map.zoomMaping=[];Geo.View3D.Map.zoomMaping[0]=15E6;Geo.View3D.Map.zoomMaping[1]=1E7;Geo.View3D.Map.zoomMaping[2]=9E6;Geo.View3D.Map.zoomMaping[3]=7644430;Geo.View3D.Map.zoomMaping[4]=4246910;
Geo.View3D.Map.zoomMaping[5]=2359390;Geo.View3D.Map.zoomMaping[6]=1310770;Geo.View3D.Map.zoomMaping[7]=728210;Geo.View3D.Map.zoomMaping[8]=404560;Geo.View3D.Map.zoomMaping[9]=224760;Geo.View3D.Map.zoomMaping[10]=154830;Geo.View3D.Map.zoomMaping[11]=86018;Geo.View3D.Map.zoomMaping[12]=47788;Geo.View3D.Map.zoomMaping[13]=26549;Geo.View3D.Map.zoomMaping[14]=14749;Geo.View3D.Map.zoomMaping[15]=8194;Geo.View3D.Map.zoomMaping[16]=4552;Geo.View3D.Map.zoomMaping[17]=2529;Geo.View3D.Map.zoomMaping[18]=1405;
Geo.View3D.Map.zoomMaping[19]=781;Geo.View3D.Map.zoomMaping[20]=100;Geo.View3D.Map.getZoomfromAlt=function(a){for(var b=0;b<Geo.View3D.Map.zoomMaping.length;b++){if(a>=Geo.View3D.Map.zoomMaping[0])return b;if(a>=Geo.View3D.Map.zoomMaping[b]&&b!=0&&a<Geo.View3D.Map.zoomMaping[b-1])return b;if(a<Geo.View3D.Map.zoomMaping[Geo.View3D.Map.zoomMaping.length-1])return Geo.View3D.Map.zoomMaping.length-1}};Geo.View3D.Map.getAltfromZoom=function(a){return(a=Geo.View3D.Map.zoomMaping[a])?a:0};
Geo.View3D.Map.getZfromLevel=Geo.View3D.Map.getAltfromZoom;Geo.View3D.Map.activexErrorInfo="";
Geo.View3D.Layer=Geo.Class({id:null,name:null,opacity:null,map:null,displayInLayerSwitcher:!0,isOnTop:!1,visibility:!0,EVENT_TYPES:["visibilitychanged"],events:null,initialize:function(a,b){this.addOptions(b);this.name=a;if(this.id==null&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"),this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES),this.eventListeners instanceof Object))this.events.on(this.eventListeners);this.opacity=1},setMap:function(a){if(this.map==null)this.map=
a},removeMap:function(){},getVisibility:function(){return this.visibility},setVisibility:function(a){if(a!=this.visibility)this.visibility=a,this.display(a)},display:function(){},setOpacity:function(){},getOptions:function(){var a={},b;for(b in this.options)a[b]=this[b];return a},addOptions:function(a){if(this.options==null)this.options={};OpenLayers.Util.extend(this.options,a);OpenLayers.Util.extend(this,a)},destroy:function(){},CLASS_NAME:"Geo.View3D.Layer"});
Geo.View3D.BaseLayerGroup=Geo.Class({id:null,layers:null,map:null,initialize:function(a){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");OpenLayers.Util.extend(this,a);if(!this.layers)this.layers=[]},setMap:function(a){if(a&&!this.map)this.map=a,this.map.addLayers(this.layers)},CLASS_NAME:"Geo.View3D.BaseLayerGroup"});
Geo.View3D.BaseLayerGroup.getTianDiTuGroup=function(a){if(a={img:[new Geo.View3D.Layer.GlobeTile("\u5168\u7403\u5f71\u50cf\u5e95\u56fe(2-10)","http://tile0.tianditu.com/services/sbsm0210"),new Geo.View3D.Layer.GlobeTile("\u5168\u7403\u5f71\u50cf\u6ce8\u8bb0(2-10)","http://tile0.tianditu.com/services/A0104_ImgAnnoE"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(14)","http://tile0.tianditu.com/services/eastdawnall"),new Geo.View3D.Layer.GlobeTile("\u5168\u7403\u5f71\u50cf(15-18)","http://tile0.tianditu.com/services/sbsm1518"),
new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(13)","http://tile0.tianditu.com/services/e13"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(12)","http://tile0.tianditu.com/services/e12"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf(11)","http://tile0.tianditu.com/services/e11"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf\u6ce8\u8bb0(11-14)","http://tile0.tianditu.com/services/B0530_eImgAnno"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u5f71\u50cf\u6ce8\u8bb0(15-18)",
"http://tile0.tianditu.com/services/siweiAnno68")],dlg:[new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf(2-10)","http://tile0.tianditu.com/services/A0512_EMap"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf\u6ce8\u8bb0(2-10)","http://tile0.tianditu.com/services/AB0512_Anno"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf(11-12)","http://tile0.tianditu.com/services/B0627_EMap1112"),new Geo.View3D.Layer.GlobeTile("\u5168\u56fd\u77e2\u91cf(13-18)","http://tile0.tianditu.com/services/siwei0608")]}[a])return new Geo.View3D.BaseLayerGroup({layers:a});
return null};Geo.View3D.LayerGroup=Geo.View3D.BaseLayerGroup;
Geo.View3D.Layer.GlobeTile=Geo.Class(Geo.View3D.Layer,{id:null,url:null,_layerData:null,initialize:function(a,b,c){Geo.View3D.Layer.prototype.initialize.apply(this,[a,c]);this.url=b},setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._layerData=a._addGlobeTileService(this.url)},removeMap:function(){var a=this.map;a&&a._removeLayerData(this._layerData);this.map=null},setVisibility:function(a){if(a!=this.visibility)this.visibility=a,this.display(a)},display:function(a){if(this._layerData&&
a!=this._layerData.LayerData.Visible)this._layerData.LayerData.Visible=a},setOpacity:function(a){Geo.View3D.Layer.prototype.setOpacity.apply(a);var b=this.map;if(b)this._layerData&&b._setLayerOpacity(this._layerData,a),this.opacity=a},gotoCenter:function(){var a=this.map;a&&this._layerData&&a._gotoLayer(this._layerData)},CLASS_NAME:"Geo.View3D.Layer.GlobeTile"});Geo.View3D.Layer.Model=Geo.Class(Geo.View3D.Layer.GlobeTile,{CLASS_NAME:"Geo.View3D.Layer.Model"});
Geo.View3D.Layer.Shape=Geo.Class(Geo.View3D.Layer,{initialize:function(a,b,c){Geo.View3D.Layer.prototype.initialize.apply(this,[a,c]);this.url=b},setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._layerData=this._addShpDate(this.url)},_addShpDate:function(a){var b=this.map.activexObj,c=null;b&&a!=""&&(c=a.split("\\"),c=c[c.length-1].split("."),c=b.CreateAddLocalDataObj().AddShpFileToScene(a,c[0]));return c},CLASS_NAME:"Geo.View3D.Layer.Shape"});
Geo.View3D.Layer.Terrain=Geo.Class(Geo.View3D.Layer.GlobeTile,{display:function(a){if(this._layerData&&a!=this._layerData.Visible)this._layerData.Visible=a},CLASS_NAME:"Geo.View3D.Layer.Terrain"});
Geo.View3D.Layer.Vector=Geo.Class(Geo.View3D.Layer,{_rasterLayer:null,_markerLayer:null,features:null,selectedFeatures:null,style:null,styleMap:null,EVENT_TYPES:["beforefeatureadded","beforefeaturesadded","featureadded","featuresadded","beforefeatureremoved","beforefeaturesremoved","featureremoved","featuresremoved","beforefeatureselected","featureselected","featureunselected","beforefeaturemodified","featuremodified","afterfeaturemodified","vertexmodified","sketchstarted","sketchmodified","sketchcomplete",
"refresh"],initialize:function(a,b){this.EVENT_TYPES=Geo.View3D.Layer.Vector.prototype.EVENT_TYPES.concat(Geo.View3D.Layer.prototype.EVENT_TYPES);this.features=[];this.selectedFeatures=[];Geo.View3D.Layer.prototype.initialize.apply(this,[a,b])},setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._rasterLayer=this.map._geoRaster.CreateGeoRasterLayer(this.id);a=this.map.activexObj.GetLayerBox().CreateLayerWrapper();a.LayerData=this._rasterLayer;this._layerData=a},addFeatures:function(a){a instanceof
Array||(a=[a]);for(var b=0,c=a.length;b<c;b++){var d=a[b];if(!d.style&&this.style)d.style=OpenLayers.Util.extend({},this.style);this.features.push(d);this.drawFeature(d)}},drawFeature:function(a){var b=this.map;if(b)b._drawGeometry({vectorLayerObj:this,featureid:a.id,rastLayer:this._rasterLayer,strPoints:this._getGeometryStr(a.geometry),type:this._getGeometryType(a.geometry),style:a.style}),a.layer=this},removeFeatures:function(a){if(a){a instanceof Array||(a=[a]);for(var b=a.length-1;b>=0;b--){var c=
a[b],d=this.map;d&&(c.style&&c.geometry.CLASS_NAME=="OpenLayers.Geometry.Point"&&c.style.externalGraphic?d._delBookMark(this.id+"_marker",c.id):d._delGeometryByName(c.id,this._rasterLayer));this.features=OpenLayers.Util.removeItem(this.features,c)}}},destroyFeatures:function(a,b){if(a==void 0)a=this.features;if(a){this.removeFeatures(a,b);for(var c=a.length-1;c>=0;c--)a[c].destroy()}},removeMap:function(){},setVisibility:function(a){if(a!=this.visibility)this.visibility=a,this.display(a)},display:function(a){if(a!=
this._rasterLayer.Visible)this._rasterLayer.Visible=a,this.map.activexObj.GetLayerBox().ReDraw()},_getGeometryType:function(a){return{"OpenLayers.Geometry.Point":0,"OpenLayers.Geometry.LineString":1,"OpenLayers.Geometry.Polygon":2}[a.CLASS_NAME]},getFeatureBy:function(a,b){for(var c=null,d=0,e=this.features.length;d<e;++d)if(this.features[d][a]==b){c=this.features[d];break}return c},getFeatureById:function(a){return this.getFeatureBy("id",a)},getFeatureByFid:function(a){return this.getFeatureBy("fid",
a)},_getGeometryStr:function(a){String.prototype.replaceAll=function(a,b){return this.replace(RegExp(a,"gm"),b)};var b=a.toString(),c=b.indexOf("(")+1,d=b.indexOf(")");if(a.CLASS_NAME=="OpenLayers.Geometry.Polygon")return b.slice(c+1,d).replaceAll(","," ");return b.slice(c,d).replaceAll(","," ")},getDataExtent:function(){var a=null,b=this.features;if(b&&b.length>0)for(var a=new Geo.Bounds,c=null,d=0,e=b.length;d<e;d++)(c=b[d].geometry)&&a.extend(c.getBounds());return a},CLASS_NAME:"Geo.View3D.Layer.Vector"});
Geo.View3D.Layer.WMS=Geo.Class(Geo.View3D.Layer.GlobeTile,{id:null,url:null,params:null,_layerData:null,initialize:function(a,b,c,d){Geo.View3D.Layer.GlobeTile.prototype.initialize.apply(this,[a,b,d]);this.url=b;this.params=c;if(!this.params.layers)throw"Error!Not WMS layers.";},setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._layerData=a._addWMSService(this.url,this.params.layers)},display:function(a){if(this._layerData)for(var b=0;b<this._layerData.length;b++)if(a!=this._layerData[b].LayerData.Visible)this._layerData[b].LayerData.Visible=
a},setOpacity:function(a){Geo.View3D.Layer.prototype.setOpacity.apply(a);var b=this.map;if(b)for(var c=0;c<this._layerData.length;c++)this._layerData&&b._setLayerOpacity(this._layerData[c],a),this.opacity=a},gotoCenter:function(){var a=this.map;a&&this._layerData&&a._gotoLayer(this._layerData[0])},removeMap:function(){var a=this.map;if(a)for(var b=0,c=this._layerData.length;b<c;b++)a._removeLayerData(this._layerData[b]);this.map=null},CLASS_NAME:"Geo.View3D.Layer.WMS"});
Geo.View3D.Layer.WMTS=Geo.Class(Geo.View3D.Layer.GlobeTile,{layerName:null,initialize:function(a,b,c){Geo.View3D.Layer.GlobeTile.prototype.initialize.apply(this,[a,b,c]);this.url=b;c=c||{};this.layerName=c.layer},setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._layerData=a._addWMTSService(this.url,this.layerName)},removeMap:function(){var a=this.map;if(a)for(var b=0,c=this._layerData.length;b<c;b++)a._removeLayerData(this._layerData[b]);this.map=null},display:function(a){if(this._layerData)for(var b=
0,c=this._layerData.length;b<c;b++){var d=this._layerData[b];if(a!=d.LayerData.Visible)d.LayerData.Visible=a}},gotoCenter:function(){var a=this.map;a&&this._layerData&&a._gotoLayer(this._layerData[0])},setOpacity:function(a){Geo.View3D.Layer.prototype.setOpacity.apply(a);var b=this.map;if(b&&this._layerData){for(var c=0;c<this._layerData.length;c++)b._setLayerOpacity(this._layerData[c],a);this.opacity=a}},CLASS_NAME:"Geo.View3D.Layer.WMTS"});
Geo.View3D.Layer.WTFS=Geo.Class(Geo.View3D.Layer.GlobeTile,{CLASS_NAME:"Geo.View3D.Layer.WTFS"});
Geo.View3D.Layer.Solid=Geo.Class(Geo.View3D.Layer,{geometry:null,height:null,faceColor:null,_localDataBox:null,_layerData:null,initialize:function(a,b,c,d){this.faceColor={top:2147483647,bottom:2147483647,round:2147483647};this.geometry=b;this.height=c;Geo.View3D.Layer.prototype.initialize.apply(this,[a,d])},setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._layerData=this._createBoxLayer(this.geometry,this.height)},removeMap:function(){this.map&&this._clearBoxLayer();this.map=
null},setHeight:function(a){this._localDataBox&&this._localDataBox.setPolyGonHeight(this._layerData.Name,a)},setFaceColor:function(a){this.faceColor=OpenLayers.Util.extend(this.faceColor,a);this._localDataBox&&this._localDataBox.SetBoxFaceColor(this._layerData.Name,this.faceColor.top,this.faceColor.bottom,this.faceColor.round)},_createBoxLayer:function(a,b){var c=this.map.activexObj;if(!this._localDataBox)this._localDataBox=c.CreateAddLocalDataObj();var d=this._getPointsThreeDegreeSpaceSplitStr(a,
0),c=this.id+"_boxLayer",d=this._localDataBox.AddPolyGon(c,d);d.Name=c;this._localDataBox.setPolyGonHeight(c,b);this._localDataBox.SetBoxFaceColor(c,this.faceColor.top,this.faceColor.bottom,this.faceColor.round);return d},_clearBoxLayer:function(){var a=this.map.activexObj,b=a.GetSceneGroup().GetLayerByName(this.id+"_boxLayer");b!=null&&a.GetSceneGroup().RemoveLayer(b)},_getPointsThreeDegreeSpaceSplitStr:function(a,b){for(var c=a.components[0].components,d=[],e=0;e<c.length;e++)d.push(c[e].x),d.push(c[e].y),
d.push(b);return d.join(" ")},CLASS_NAME:"Geo.View3D.Layer.Solid"});Geo.View3D.Layer.WCS=Geo.Class(Geo.View3D.Layer.GlobeTile,{setMap:function(a){Geo.View3D.Layer.prototype.setMap.apply(this,[a]);this._layerData=a._addWCSService(this.url)},CLASS_NAME:"Geo.View3D.Layer.WCS"});
Geo.View3D.Event.MouseEvent={isMousemove:function(a){if(a.MouseButton===-1&&a.MouseState===1)return!0},isMouseDown:function(a){if(a.MouseButton===0&&a.MouseState===0)return!0},isLeftClick:function(a){if(a.MouseButton===0&&a.MouseState===0)return!0},isMouseUp:function(a){if(a.MouseButton===0&&a.MouseState===2)return!0},isRightClick:function(a){if(a.MouseButton===2&&a.MouseState===2)return!0},getMouseScreen:function(a){return{x:a.ScreenX,y:a.ScreenY}},getMouseLocation:function(a){return{lon:a.Longitude,
lat:a.Latitude,alt:a.Altitude}},isKeyDown:function(a){if(a.EventType===6)return!0},isKeyUp:function(a){if(a.EventType===7)return!0},KEY_SPACE:32,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PLUS:187,KEY_MINUS:189,CLASS_NAME:"Geo.View3D.Event.MouseEvent"};
Geo.View3D.Handler=Geo.Class({id:null,active:!1,control:null,map:null,initialize:function(a,b,c){OpenLayers.Util.extend(this,c);this.control=a;this.callbacks=b;(a=this.map||a.map)&&this.setMap(a);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){if(a)this.map=a,this.map.handlers.push(this)},callback:function(a,b){a&&this.callbacks[a]&&this.callbacks[a].apply(this.control,b)},listener:function(){},activate:function(){if(this.active)return!1;return this.active=!0},deactivate:function(){if(!this.active)return!1;
this.active=!1;return!0},destroy:function(){this.deactivate();this.map&&OpenLayers.Util.removeItem(this.map.handlers,this);this.control=this.map=null},CLASS_NAME:"Geo.View3D.Handler"});
Geo.View3D.Handler.Box=Geo.Class(Geo.View3D.Handler,{initialize:function(){Geo.View3D.Handler.prototype.initialize.apply(this,arguments)},listener:function(a){if(a.MouseState==0)this.map.activexObj.mousePoints=a.Longitude+","+a.Latitude;else{if(a.MouseState==2)this.map.activexObj.mousePoints=this.map.activexObj.mousePoints+","+a.Longitude+","+a.Latitude;a=this.map.activexObj.mousePoints.split(",");this.callback("emitMouseHandler",[a[0]+","+a[3]+","+a[2]+","+a[1]])}},activate:function(){if(!Geo.View3D.Handler.prototype.activate.apply(this,
arguments))return!1;this.map.activexObj.CurrentOpState=2;return!0},deactivate:function(){if(!Geo.View3D.Handler.prototype.deactivate.apply(this,arguments))return!1;this.map.activexObj.CurrentOpState=0;return!0},CLASS_NAME:"Geo.View3D.Handler.Box"});
Geo.View3D.Handler.KeybordDefaults=Geo.Class(Geo.View3D.Handler,{listener:function(a){if(Geo.View3D.Event.MouseEvent.isKeyDown(a)){if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_SPACE)this.onKeySpace(a);if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_LEFT)this.onKeyLeft(a);if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_UP)this.onKeyUp(a);if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_RIGHT)this.onKeyRight(a);if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_DOWN)this.onKeyDown(a);if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_PLUS)this.onKeyPlus(a);
if(a.KEYCODE==Geo.View3D.Event.MouseEvent.KEY_MINUS)this.onKeyMinus(a)}},onKeySpace:function(){},onKeyLeft:function(){},onKeyUp:function(){},onKeyRight:function(){},onKeyDown:function(){},onKeyPlus:function(){},onKeyMinus:function(){},CLASS_NAME:"Geo.View3D.Handler.KeybordDefaults"});
Geo.View3D.Handler.Mouse=Geo.Class(Geo.View3D.Handler,{initialize:function(){Geo.View3D.Handler.prototype.initialize.apply(this,arguments)},listener:function(a){Geo.View3D.Event.MouseEvent.isLeftClick(a)&&this.callback("click",[a]);Geo.View3D.Event.MouseEvent.isMousemove(a)&&this.callback("mouseMove",[a]);Geo.View3D.Event.MouseEvent.isRightClick(a)&&this.callback("rightClick",[a])},CLASS_NAME:"Geo.View3D.Handler.Mouse"});
Geo.View3D.Handler.ModelChoose=Geo.Class(Geo.View3D.Handler,{initialize:function(){Geo.View3D.Handler.prototype.initialize.apply(this,arguments)},listener:function(a){a.HitTestObjectID.length!=0&&this.callback("chooseModel",[a])},activate:function(){if(!Geo.View3D.Handler.prototype.activate.apply(this,arguments))return!1;this.map.activexObj.CurrentOpState=1;return!0},deactivate:function(){if(!Geo.View3D.Handler.prototype.deactivate.apply(this,arguments))return!1;this.map.activexObj.CurrentOpState=
0;return!0},CLASS_NAME:"Geo.View3D.Handler.ModelChoose"});
Geo.View3D.Handler.Point=Geo.Class(Geo.View3D.Handler,{point:null,layer:null,persist:!1,layerOptions:null,initialize:function(a,b){if(!b||!b.layerOptions||!b.layerOptions.styleMap)this.style=OpenLayers.Util.extend(Geo.Feature.Vector.style["default"],{});Geo.View3D.Handler.prototype.initialize.apply(this,arguments)},listener:function(a){if(!Geo.View3D.Event.MouseEvent.isKeyDown(a)&&!Geo.View3D.Event.MouseEvent.isKeyUp(a)&&!Geo.View3D.Event.MouseEvent.isMousemove(a)){var b=a.Longitude,c=a.Latitude;
Geo.View3D.Event.MouseEvent.isMouseDown(a)&&this.createFeature(new Geo.LonLat(b,c));Geo.View3D.Event.MouseEvent.isMouseUp(a)&&(this.persist&&this.layer.destroyFeatures(),this.callback("done",[this.point.geometry.clone()]))}},activate:function(){if(!Geo.View3D.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,isOnTop:!0},this.layerOptions);this.layer=new Geo.View3D.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);this._setGeoRaster();
return!0},createFeature:function(a){this.point=new Geo.Feature.Vector(new Geo.Geometry.Point(a.lon,a.lat));this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!Geo.View3D.Handler.prototype.deactivate.apply(this,arguments))return!1;this.destroyFeature();this.layer.map!=null&&this.layer.destroy(!1);this.layer=null;this.map.activexObj.SetPickedState(!1);return!0},destroyFeature:function(){this.layer&&this.layer.destroyFeatures();this.point=null},
_setGeoRaster:function(){this.map._geoRaster.GeoRasterType=1;this.map.activexObj.SetPickedState(!0)},CLASS_NAME:"Geo.View3D.Handler.Point"});
Geo.View3D.Handler.Path=Geo.Class(Geo.View3D.Handler,{point:null,line:null,layer:null,persist:!1,layerOptions:null,_isDone:!1,initialize:function(a,b){if(!b||!b.layerOptions||!b.layerOptions.styleMap)this.style=OpenLayers.Util.extend(Geo.Feature.Vector.style["default"],{});Geo.View3D.Handler.prototype.initialize.apply(this,arguments)},listener:function(a){if(!Geo.View3D.Event.MouseEvent.isKeyDown(a)&&!Geo.View3D.Event.MouseEvent.isKeyUp(a)&&!Geo.View3D.Event.MouseEvent.isMousemove(a)){if(Geo.View3D.Event.MouseEvent.isLeftClick(a)){if(this._isDone)this.layer.removeFeatures(this.line),
this.line=null,this._isDone=!1;this.addPoint(new Geo.LonLat(a.Longitude,a.Latitude));this.callback("point",[this.point.geometry,this.line.geometry])}if(Geo.View3D.Event.MouseEvent.isRightClick(a))this._isDone=!0,this.persist&&this.layer.destroyFeatures(),this.line&&this.callback("done",[this.line.geometry.clone()])}},activate:function(){if(!Geo.View3D.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,isOnTop:!0},this.layerOptions);this.layer=
new Geo.View3D.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);this._setGeoRaster();return!0},addPoint:function(a){this.point=new Geo.Feature.Vector(new Geo.Geometry.Point(a.lon,a.lat));this.point.geometry.clearBounds();this.line?(a=this.line.geometry.components,a.push(this.point.geometry),a=new Geo.Geometry.LineString(a)):a=new Geo.Geometry.LineString([this.point.geometry]);this.layer.removeFeatures(this.line);this.line=new Geo.Feature.Vector(a);this.layer.addFeatures([this.line],{silent:!0})},
createFeature:function(a){this.point=new Geo.Feature.Vector(new Geo.Geometry.Point(a.lon,a.lat));this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!Geo.View3D.Handler.prototype.deactivate.apply(this,arguments))return!1;this.destroyFeature();this.layer.map!=null&&this.layer.destroy(!1);this.layer=null;this.map.activexObj.SetPickedState(!1);return!0},destroyFeature:function(){this.layer&&this.layer.destroyFeatures();this.line=this.point=null},
_setGeoRaster:function(){this.map._geoRaster.GeoRasterType=1;this.map.activexObj.SetPickedState(!0)},CLASS_NAME:"Geo.View3D.Handler.Path"});
Geo.View3D.Handler.Polygon=Geo.Class(Geo.View3D.Handler,{_points:[],point:null,polygon:null,layer:null,persist:!1,checkSelfCross:!0,_isDone:!1,layerOptions:null,initialize:function(a,b){if(!b||!b.layerOptions||!b.layerOptions.styleMap)this.style=OpenLayers.Util.extend(Geo.Feature.Vector.style["default"],{});Geo.View3D.Handler.prototype.initialize.apply(this,arguments)},listener:function(a){if(!Geo.View3D.Event.MouseEvent.isKeyDown(a)&&!Geo.View3D.Event.MouseEvent.isKeyUp(a)&&!Geo.View3D.Event.MouseEvent.isMousemove(a)){if(Geo.View3D.Event.MouseEvent.isLeftClick(a)){if(this._isDone)this.layer.removeFeatures(this.polygon),
this.polygon=null,this._isDone=!1;var b=a.Longitude,c=a.Latitude;this._points.push(new Geo.Geometry.Point(b,c));var d=new Geo.Geometry.LinearRing(this._points),d=new Geo.Geometry.Polygon([d]);if(this.checkSelfCross&&this._checkSelfCross(d))return;this.addPoint(new Geo.LonLat(b,c));this.callback("point",[this.point.geometry,this.polygon.geometry])}if(Geo.View3D.Event.MouseEvent.isRightClick(a))this._isDone=!0,this._points=[],this.persist&&this.layer.destroyFeatures(),this.polygon&&this.callback("done",
[this.polygon.geometry.clone()])}},activate:function(){if(!Geo.View3D.Handler.prototype.activate.apply(this,arguments))return!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,isOnTop:!0},this.layerOptions);this.layer=new Geo.View3D.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);this._setGeoRaster();return!0},addPoint:function(a){this.point=new Geo.Feature.Vector(new Geo.Geometry.Point(a.lon,a.lat));this.point.geometry.clearBounds();this.polygon?(a=this.polygon.geometry.components[0].components,
a.push(this.point.geometry),a=new Geo.Geometry.LinearRing(a)):a=new Geo.Geometry.LinearRing([this.point.geometry]);a=new Geo.Geometry.Polygon([a]);this.layer.removeFeatures(this.polygon);this.polygon=new Geo.Feature.Vector(a);this.layer.addFeatures([this.polygon],{silent:!0})},createFeature:function(a){this.point=new Geo.Feature.Vector(new Geo.Geometry.Point(a.lon,a.lat));this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!Geo.View3D.Handler.prototype.deactivate.apply(this,
arguments))return!1;this.destroyFeature();this.layer.map!=null&&this.layer.destroy(!1);this.layer=null;this.map.activexObj.SetPickedState(!1);return!0},destroyFeature:function(){this.layer&&this.layer.destroyFeatures();this.polygon=this.point=null},_setGeoRaster:function(){this.map._geoRaster.GeoRasterType=1;this.map.activexObj.SetPickedState(!0)},_checkSelfCross:function(a){return this.map.activexObj.SetTerrainAnalysisParam(this._getPointsSpaceSplitStr(a),0,-1)},_getPointsSpaceSplitStr:function(a){for(var a=
a.components[0].components,b=[],c=0;c<a.length;c++)b.push(a[c].x),b.push(a[c].y);return b.join(" ")},CLASS_NAME:"Geo.View3D.Handler.Polygon"});
Geo.View3D.Control=Geo.Class({id:null,autoActivate:!1,active:!1,handler:null,eventListeners:null,events:null,EVENT_TYPES:["activate","deactivate"],map:null,initialize:function(a){OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this,null,this.EVENT_TYPES);if(this.eventListeners instanceof Object)this.events.on(this.eventListeners);if(this.id==null)this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(a){this.map=a;this.handler&&this.handler.setMap(a)},draw:function(){},
listener:function(){},activate:function(){if(this.active)return!1;this.handler&&this.handler.activate();this.active=!0;this.events.triggerEvent("activate");return!0},deactivate:function(){if(this.active)return this.handler&&this.handler.deactivate(),this.active=!1,this.events.triggerEvent("deactivate"),!0;return!1},destroy:function(){if(this.events)this.eventListeners&&this.events.un(this.eventListeners),this.events.destroy(),this.events=null;this.eventListeners=null;if(this.handler)this.handler.destroy(),
this.handler=null;if(this.handlers){for(var a in this.handlers)this.handlers.hasOwnProperty(a)&&typeof this.handlers[a].destroy=="function"&&this.handlers[a].destroy();this.handlers=null}if(this.map)this.map.removeControl(this),this.map=null},CLASS_NAME:"Geo.View3D.Control"});
Geo.View3D.Control.KeyboardDefaults=Geo.Class(Geo.View3D.Control,{autoActivate:!0,delta:5,initialize:function(){Geo.View3D.Control.prototype.initialize.apply(this,arguments);this.handler=new Geo.View3D.Handler.KeybordDefaults(this,null,{onKeySpace:OpenLayers.Function.bind(this.resetNorth,this),onKeyLeft:OpenLayers.Function.bind(this.panLeft,this),onKeyUp:OpenLayers.Function.bind(this.panUp,this),onKeyRight:OpenLayers.Function.bind(this.panRight,this),onKeyDown:OpenLayers.Function.bind(this.panDown,
this),onKeyPlus:OpenLayers.Function.bind(this.zoomIn,this),onKeyMinus:OpenLayers.Function.bind(this.zoomOut,this)})},resetNorth:function(){this.map&&this.map.resetNorth()},panLeft:function(){this.pan("left")},panUp:function(){this.pan("up")},panRight:function(){this.pan("right")},panDown:function(){this.pan("down")},pan:function(a){var b=this.delta,c=this.map.activexObj.GetCamera();switch(a){case "left":c.Pan(-b,0);break;case "up":c.Pan(0,b);break;case "right":c.Pan(b,0);break;case "down":c.Pan(0,
-b)}},zoomIn:function(){var a=this.map;a&&a.zoomIn()},zoomOut:function(){var a=this.map;a&&a.zoomOut()},CLASS_NAME:"Geo.View3D.Control.KeyboardDefaults"});
Geo.View3D.Control.Measure=Geo.Class(Geo.View3D.Control,{serviceUrl:null,layerLevel:null,layerName:null,failFn:null,_terrainAnalysisService:null,handlerType:null,handlerOptions:null,_points:null,_result:null,callbacks:null,initialize:function(a,b){Geo.View3D.Control.prototype.initialize.apply(this,[b]);this.serviceUrl=a;this._terrainAnalysisService=new Geo.Service.TAS(this.id+"_service",a);this.callbacks=OpenLayers.Util.extend({done:this._onComplete,point:this._onAddPoint},this.callbacks);this.handlerOptions=
this.handlerOptions||{};if(this.handlerType)this.handler=new this.handlerType(this,this.callbacks,this.handlerOptions)},_isComplete:!1,onAddPoint:function(){},onComplete:function(){},_onComplete:function(){},_onAddPoint:function(){},_measureHandler:function(){},setMeasureService:function(a){if(a&&this._terrainAnalysisService)this._terrainAnalysisService.url=a},_getMeasureResult:function(a,b,c){var d={pointCount:this._terrainAnalysisService._countCoord(b.coordinates),layerLevel:this.layerLevel,layerName:this.layerName,
subjoin:0},b=OpenLayers.Util.applyDefaults(b,d);if(d=this._terrainAnalysisService)d[a](b,c,this.failFn)},activate:function(){if(Geo.View3D.Control.prototype.activate.apply(this,arguments))this.map._measureHandler=OpenLayers.Function.bind(this._measureHandler,this),this.setMeasureService(this.serviceUrl);return!0},_getPointsThreeDegreeSpaceSplitStr:function(a,b){for(var c=a.components[0].components,d=[],e=0;e<c.length;e++)d.push(c[e].x),d.push(c[e].y),d.push(b);return d.join(" ")},_getPointsSpaceSplitStr:function(a){for(var a=
a.components[0].components,b=[],c=0;c<a.length;c++)b.push(a[c].x),b.push(a[c].y);return b.join(" ")},_setMeasureParams:function(a,b,c){var d=this.map.activexObj;a!==void 0&&d.SetTerrainAnalysisParam(b,c,a)},_clearBoxLayer:function(){var a=this.map.activexObj,b=a.GetSceneGroup().GetLayerByName(this.id+"_boxLayer");b!=null&&a.GetSceneGroup().RemoveLayer(b)},_createBoxLayer:function(a){var b=this.map.activexObj.CreateAddLocalDataObj(),a=this._getPointsThreeDegreeSpaceSplitStr(a,0),c=this.id+"_boxLayer";
b.AddPolyGon(c,a).name=c;b.setPolyGonHeight(c,this.height);b.SetBoxFaceColor(c,2147483647,2147483647,2147483647)},CLASS_NAME:"Geo.View3D.Control.Measure"});
Geo.View3D.Control.DrawPath=Geo.Class(Geo.View3D.Control,{type:Geo.View2D.Control.TYPE_TOOL,handlerOptions:null,callbacks:null,initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.done},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.handler=new Geo.View3D.Handler.Path(this,this.callbacks,this.handlerOptions)},done:function(){}});
Geo.View3D.Control.DrawPoint=Geo.Class(Geo.View3D.Control,{type:Geo.View2D.Control.TYPE_TOOL,handlerOptions:null,callbacks:null,initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.done},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.handler=new Geo.View3D.Handler.Point(this,this.callbacks,this.handlerOptions)},done:function(){}});
Geo.View3D.Control.DrawPolygon=Geo.Class(Geo.View3D.Control,{type:Geo.View2D.Control.TYPE_TOOL,handlerOptions:null,callbacks:null,initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({done:this.done},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.handler=new Geo.View3D.Handler.Polygon(this,this.callbacks,this.handlerOptions)},done:function(){}});
Geo.View3D.Control.DrawFeature=Geo.Class(Geo.View3D.Control,{layer:null,callbacks:null,EVENT_TYPES:["featureadded"],featureAdded:function(){},handlerOptions:null,initialize:function(a,b,c){this.EVENT_TYPES=Geo.View3D.Control.DrawFeature.prototype.EVENT_TYPES.concat(Geo.View3D.Control.prototype.EVENT_TYPES);Geo.View3D.Control.prototype.initialize.apply(this,[c]);this.callbacks=OpenLayers.Util.extend({done:this.drawFeature},this.callbacks);this.layer=a;this.handlerOptions=this.handlerOptions||{};if(a=
this.layer.styleMap&&this.layer.styleMap.styles.temporary)this.handlerOptions.layerOptions=OpenLayers.Util.applyDefaults(this.handlerOptions.layerOptions,{styleMap:new Geo.StyleMap({"default":a})});this.handler=new b(this,this.callbacks,this.handlerOptions)},drawFeature:function(a){a=new Geo.Feature.Vector(a);this.layer.addFeatures([a]);this.featureAdded(a);this.events.triggerEvent("featureadded",{feature:a})},CLASS_NAME:"Geo.View3D.Control.DrawFeature"});
Geo.View3D.Control.SelectFeature=Geo.Class(Geo.View3D.Control,{EVENT_TYPES:["beforefeaturehighlighted","featurehighlighted","featureunhighlighted"],onBeforeSelect:function(){},onSelect:function(){},onUnselect:function(){},layer:null,initialize:function(a,b){this.EVENT_TYPES=Geo.View3D.Control.SelectFeature.prototype.EVENT_TYPES.concat(Geo.View3D.Control.prototype.EVENT_TYPES);Geo.View3D.Control.prototype.initialize.apply(this,[b]);this.layer=a},destroy:function(){},activate:function(){},scope:null,
unselectAll:function(){for(var a=this.layer.selectedFeatures.length-1;a>=0;--a);},highlight:function(){},unhighlight:function(){},select:function(a){var b=this.onBeforeSelect.call(this.scope,a),c=a.layer;b!==!1&&(b=c.events.triggerEvent("beforefeatureselected",{feature:a}),b!==!1&&(c.selectedFeatures.push(a),this.highlight(a),c.events.triggerEvent("featureselected",{feature:a}),this.onSelect.call(this.scope,a)))},unselect:function(a){var b=a.layer;this.unhighlight(a);OpenLayers.Util.removeItem(b.selectedFeatures,
a)},setMap:function(){Geo.View3D.Control.prototype.setMap.apply(this,arguments)},CLASS_NAME:"Geo.View3D.Control.SelectFeature"});
Geo.View3D.Control.Attribution=Geo.Class(Geo.View3D.Control,{separator:",",style:{startX:10,startY:10,endX:300,endY:300,fontSize:20,fontFamily:"\u96c5\u9ed1",opacity:255,colorR:255,colorG:255,colorB:0},initialize:function(){Geo.View3D.Control.prototype.initialize.apply(this,arguments)},destroy:function(){Geo.View3D.Control.prototype.destroy.apply(this,arguments)},setMap:function(){Geo.View3D.Control.prototype.setMap.apply(this,arguments)},draw:function(){Geo.View3D.Control.prototype.draw.apply(this,
arguments);this.map.events.on({loadlayergroup:this.updateAttribution,scope:this});this.updateAttribution();this.setAttributionLayerTop()},updateAttribution:function(){if(this.map&&this.map.activexObj){var a=this.map.activexObj,b=[];if(this.map.layers){for(var c=0,d=this.map.layers.length;c<d;c++){var e=this.map.layers[c];e.attribution&&e.getVisibility()&&OpenLayers.Util.indexOf(b,e.attribution)===-1&&b.push(e.attribution)}b=b.join(this.separator);a.AddText(1,b,this.style.startX,this.style.startY,
this.style.endX,this.style.endY,this.style.fontSize,this.style.fontFamily,this.style.opacity,this.style.colorR,this.style.colorG,this.style.colorB)}}},setAttributionLayerTop:function(){if(this.map&&this.map.activexObj)for(var a=this.map.activexObj.GetLayerBox().GetSpecialLayer(0),b=this.map.layers.length,c=0;c<b;c++)this.map._moveLayerDown(a)},CLASS_NAME:"Geo.View3D.Control.Attribution"});
Geo.View3D.Control.Box=Geo.Class(Geo.View3D.Control,{handlerOptions:null,callbacks:null,initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({emitMouseHandler:this.emitMouseHandler},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.handler=new Geo.View3D.Handler.Box(this,this.callbacks,this.handlerOptions)},emitMouseHandler:function(){},CLASS_NAME:"Geo.View3D.Control.Box"});
Geo.View3D.Control.Mouse=Geo.Class(Geo.View3D.Control,{handlerOptions:null,callbacks:null,initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({click:this.onClick,rightClick:this.onRightClick,mouseMove:this.onMouseMove},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.handler=new Geo.View3D.Handler.Mouse(this,this.callbacks,this.handlerOptions)},onClick:function(){},onRightClick:function(){},onMouseMove:function(){},CLASS_NAME:"Geo.View3D.Control.Mouse"});
Geo.View3D.Fly=Geo.Class({layer:null,layerOptions:null,map:null,drawPathControl:null,defaultFlyParams:{height:0,speed:0,tilt:0,heading:0},model:null,points:null,pathVisible:!0,initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,arguments);a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,isOnTop:!0},this.layerOptions);this.layer=new Geo.View3D.Layer.Vector(this.CLASS_NAME+"_layer",a);this.drawPathControl=new Geo.View3D.Control.DrawFeature(this.layer,Geo.View3D.Handler.Path,
{featureAdded:OpenLayers.Function.bind(function(a){this.setFlyMode(Geo.View3D.Fly_MODE_PATH);this.controlFly(Geo.View3D.FLY_STOP);this.addFeatureToPoints(a);this.drawPathControl.deactivate()},this)});this.points=[];this.model={path:"",visible:!1}},setMap:function(a){if(!this.map)this.map=a,this._initFlyOption(),a.addLayers([this.layer]),a.addControls([this.drawPathControl])},setPathVisible:function(a){this.drawPathControl.deactivate();this.layer.setVisibility(a);this.pathVisible=a},clearFlyPath:function(){this.controlFly(Geo.View3D.FLY_STOP);
this.layer.removeFeatures(this.layer.features);this.points=[];this._clearAllFlyPoint();this.drawPathControl.deactivate()},activate:function(){Geo.View3D.Control.prototype.activate.apply(this,arguments);this._initFlyOption()},onComplete:function(){},onAddPoint:function(){},addPoints:function(){},addFeatureToPoints:function(a){this.points=[];for(var a=a.geometry.components,b=0;b<a.length;b++)this.points.push({longitude:a[b].x,latitude:a[b].y});this.setFlyPath();this.controlFly(Geo.View3D.FLY_START)},
addPoint:function(a){a.flyHeight=a.flyHeight||this.defaultFlyParams.height;a.flyTilt=a.flyTilt||this.defaultFlyParams.tilt;a.flyHeading=a.flyHeading||this.defaultFlyParams.heading;a.flySpeed=a.flySpeed||this.defaultFlyParams.speed;this._addFlyPoint({longitude:a.longitude,latitude:a.latitude,flyHeight:a.flyHeight,flyTilt:a.flyTilt,flyHeading:a.flyHeading,bank:0,flySpeed:a.flySpeed,flyRoute:this._flyRoute,flyMode:this._flyRoute.FlyMode});this.points.push(a)},setTilt:function(a){a=a<0?0:a;this._flyMotion.FlyTilt=
a>90?90:a;this._flyMotion.IsRealtimeAdjust=!0},setHeading:function(a){this._flyMotion.FlyHeading=a;this._flyMotion.IsRealtimeAdjust=!0},setFlyPath:function(){this._clearAllFlyPoint();this.defaultFlyParams.height=this._camera.Distance;this.defaultFlyParams.speed=this._camera.Distance/1E4;this.defaultFlyParams.tilt=this._camera.Tilt;for(var a=0;a<this.points.length;a++){var b=OpenLayers.Util.extend({},this.points[a]);b.flyHeight=b.flyHeight||this.defaultFlyParams.height;b.flyTilt=b.flyTilt||this.defaultFlyParams.tilt;
b.flyHeading=b.flyHeading||this.defaultFlyParams.heading;b.flySpeed=b.flySpeed||this.defaultFlyParams.speed;this._addFlyPoint({longitude:b.longitude,latitude:b.latitude,flyHeight:b.flyHeight,flyTilt:b.flyTilt,flyHeading:b.flyHeading,bank:0,flySpeed:b.flySpeed,flyRoute:this._flyRoute,flyMode:this._flyRoute.FlyMode})}},getFlyPath:function(){return this.points},controlFly:function(a){switch(a){case Geo.View3D.FLY_START:this._startFly();break;case Geo.View3D.FLY_PASUE:this._flyPause();break;case Geo.View3D.FLY_CONTINUE:this._flyContinue();
break;case Geo.View3D.FLY_STOP:this._flyStop()}},setFlyCameraHeight:function(a){this._flyMotion.FlyHeight=a;this._flyMotion.IsRealtimeAdjust=!0},setFlySpeed:function(a){this._flyMotion.FlySpeed=a;this._flyMotion.IsRealtimeAdjust=!0},setFlyMode:function(a,b){b=b||0;this._flyRoute.FlyMode=a;this._camera.CameraMode=0;this._camera.CameraRoamingMode=0;if(a!==1){if(b==0)this._flyMotion.FlyHeightStyle=2;if(b==1)this._flyMotion.FlyHeightStyle=3}},saveFlyPathToFile:function(a){this._flyRoute.SaveFlyPathToFile(a)},
loadFlyPathFromFile:function(a){this._flyRoute.LoadFlyPathFromFile(a)},getGeometryFromFlyPoints:function(){if(this._flyRoute){for(var a=[],b=0;b<this._flyRoute.GetCount();b++){var c=this._flyMotionWrapper.GetPoint(this._flyRoute,b),c=new Geo.Geometry.Point(c.XVal,c.YVal);a.push(c)}return new Geo.Geometry.LineString(a)}return null},setModelPath:function(a){var b=this.map.activexObj;if(b&&this.model.path!==a)this.model.path=a,this.model.visible=!1,b.SetModelVisible(a,this.model.visible)},setModelVisible:function(a){var b=
this.map.activexObj;if(b)this.model.visible=a,b.SetModelVisible(this.model.path,a)},_getFlySpeed:function(a){return a*14},_flyRoute:null,_flyMotion:null,_camera:null,_initFlyOption:function(){var a=this.map.activexObj;if(a)this._flyRoute=a.CreateFlyRoute(),this._flyMotion=a.CreateFlyMotion(),this._flyMotionWrapper=a.GetFlyMotionWrapper(),this._camera=a.GetCamera()},_startFly:function(){this._flyMotion&&(this._flyMotion.SetFlyRoute(this._flyRoute),this._flyMotion.SetCamera(this._camera),this._flyContinue())},
_flyPause:function(){if(this._flyMotion)this._camera.CameraMode=1,this._flyMotion.Pause()},_flyContinue:function(){if(this._flyMotion)this._camera.CameraMode=0,this._flyMotion.Fly()},_flyStop:function(){if(this._flyMotion)this._camera.CameraMode=1,this._flyMotion.Stop()},_clearAllFlyPoint:function(){this._flyRoute&&this._flyRoute.removeAll()},_addFlyPoint:function(a){var b=this.map.activexObj;b&&b.AddFlyPoint(a.longitude,a.latitude,a.flyHeight,a.flyTilt,a.flyHeading,0,a.flySpeed,a.flyRoute,a.flyMode)},
CLASS_NAME:"Geo.View3D.Fly"});Geo.View3D.FLY_START=1;Geo.View3D.FLY_PASUE=2;Geo.View3D.FLY_CONTINUE=3;Geo.View3D.FLY_STOP=4;Geo.View3D.Fly_MODE_ROUND=1;Geo.View3D.Fly_MODE_PATH=0;
Geo.View3D.Popup=Geo.Class({id:"",lonlat:null,size:null,contentHTML:null,map:null,initialize:function(a,b,c,d,e){a==null&&(a=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=a;this.lonlat=b;this.contentSize=c!=null?c:new Geo.Size(Geo.View3D.Popup.WIDTH,Geo.View3D.Popup.HEIGHT);if(d!=null)this.contentHTML=d;this._closeBox=new Boolean(e)},draw:function(){this._draw()},_draw:function(){var a=this.map;if(a&&a.activexObj){var b=this.lonlat,c=this.contentSize,a=a.activexObj.GetSceneGroup();
a.DeleteBubbleWindow();a.CreateBubbleWindow();a.SetBubblePoint(b.lon,b.lat);a.SetBubbleLocation(300,100,c.w,c.h);a.SetBubbleContent(this.contentHTML);a.SetBubbleWindowVisible(!0)}},_clear:function(){var a=this.map;a&&a.activexObj&&a.activexObj.GetSceneGroup().DeleteBubbleWindow()},CLASS_NAME:"Geo.View3D.Popup"});Geo.View3D.Popup.WIDTH=270;Geo.View3D.Popup.HEIGHT=152;Geo.View3D.Popup.COLOR="white";Geo.View3D.Popup.OPACITY=1;Geo.View3D.Popup.BORDER="0px";
Geo.View3D.Popup.FramedCloud=Geo.Class(Geo.View3D.Popup,{initialize:function(a,b,c,d,e,f,g){Geo.View3D.Popup.prototype.initialize.apply(this,[a,b,c,d,f,g])},CLASS_NAME:"Geo.View3D.Popup.FramedCloud"});
Geo.View3D.FeatureManager=Geo.Class({id:null,map:null,_typeMapping:null,featureSortField:"featureSort",orderNumberField:"orderNumber",vectorLayer:null,selectControl:null,maxFeaturesPerPage:15,initialize:function(a){this._typeMapping={};this.registerResultType("default");OpenLayers.Util.extend(this,a)},setMap:function(a){if(a&&!this.map)this.map=a,this.vectorLayer=new Geo.View3D.Layer.Vector("GeoGlobeFeatureManagerVector",{isOnTop:!0,displayInLayerSwitcher:!1}),this.map.addLayer(this.vectorLayer),
this._initSelectControl()},registerFeatureSort:function(a,b){this._typeMapping[a]=OpenLayers.Util.extend({features:[],currentPage:0,maxFeaturesPerPage:this.maxFeaturesPerPage,onTurnToPage:this.onTurnToPage,onFeatureSelect:Geo.View3D.FeatureManager.showFramedCloud,onFeatureUnselect:Geo.View3D.FeatureManager.closeFramedCloud,onFeatureOver:Geo.View3D.FeatureManager.showTopic,onFeatureOut:Geo.View3D.FeatureManager.closeTopic},b)},registerResultType:function(a,b){this.registerFeatureSort(a,b)},addFeatures:function(a,
b,c){b=b||"default";a instanceof Array||(a=[a]);if(this._typeMapping[b]){var a=this._addTypeMarker(a,b),d=this._typeMapping[b].style;d&&this._addStyleForFeatures(a,d);c?this._typeMapping[b].features.concat(a):(this.clearResultFromMap(b),this._typeMapping[b].features=a);this._typeMapping[b].currentPage=0}},onTurnToPage:function(){},turnToPageN:function(a,b){var b=b||"default",c=this._typeMapping[b],d=this.getTotalPageNumber(b),a=a<=0?1:a,a=a>d?d:a,d=this._pagingFeatures({maxPerPage:c.maxFeaturesPerPage,
pageNum:a,resultArr:c.features});this.addOrderForFeatures(d);if(a!==c.currentPage)this.clearResultFromMap(b),this.drawFeaturesToMap(d),c.currentPage=a;c.onTurnToPage(d);return d},turnToFirst:function(a,b){return this.turnToPageN(1,a||"default",b)},turnToNext:function(a,b){a=a||"default";return this.turnToPageN(this._typeMapping[a].currentPage+1,a,b)},turnToPre:function(a,b){a=a||"default";return this.turnToPageN(this._typeMapping[a].currentPage-1,a,b)},turnToLast:function(a,b){a=a||"default";this.turnToPageN(this.getTotalPageNumber(a),
a,b)},getPageInfo:function(a){a=this._typeMapping[a||"default"];return Math.ceil(a.features.length/a.maxFeaturesPerPage)},getTotalPageNumber:function(a){a=this._typeMapping[a||"default"];return Math.ceil(a.features.length/a.maxFeaturesPerPage)},getFeatures:function(a){return this._typeMapping[a||"default"].features},drawFeaturesToMap:function(a){var b,c,d;b=this.map;c=this.vectorLayer;if(typeof a=="string"){var e=a||"default";this._typeMapping[e]&&b&&(d=this.getFeatures(e))}a instanceof Array&&(d=
a);c.addFeatures(d);c.map.zoomToExtent(c.getDataExtent())},selectFeatureById:function(a){this.selectControl.unselectAll();this.selectControl.select(this.vectorLayer.getFeatureById(a))},clearFeatureFromMap:function(a){var a=a||"default",b=this._typeMapping[a],c=this.vectorLayer,a=a=="allType"?this.vectorLayer.features:b?b.features:[];c&&(this.selectControl.unselectAll(),c.removeFeatures(a))},clearResultFromMap:function(a){this.clearFeatureFromMap(a)},addOrderForFeatures:function(a){for(var b=0;b<a.length;b++)a[b].attributes[this.orderNumberField]=
b;return a},_addStyleForFeatures:function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(!d.style)d.style=b}},_addTypeMarker:function(a,b){for(var c=0;c<a.length;c++)a[c].attributes[this.featureSortField]=b;return a},_pagingFeatures:function(a){for(var b=a.maxPerPage,c=a.pageNum,a=a.resultArr.slice((c-1)*b,c*b-1+1),b=0;b<a.length;b++)a[b].attributes[this.orderNumberField]=b;return a},_dispatchEvent:function(a,b,c){a._typeMapping[b.attributes[a.featureSortField]][c](b)},_initSelectControl:function(){if(this.map&&
!this.selectControl)this.selectControl=new Geo.View3D.Control.SelectFeature(this.vectorLayer,{onSelect:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureSelect")},this),onUnselect:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureUnselect")},this),callbacks:{over:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureOver")},this),out:OpenLayers.Function.bind(function(a){this._dispatchEvent(this,a,"onFeatureOut")},this)}}),this.map.addControl(this.selectControl)}});
Geo.View3D.FeatureManager.defaultStyleMap=new Geo.StyleMap({"default":new Geo.Style({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10,graphicYOffset:-12}),select:new Geo.Style({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker-blue.png",graphicWidth:21,graphicHeight:25,graphicXOffset:-10,graphicYOffset:-12})});
Geo.View3D.FeatureManager.showFramedCloud=function(a,b){var c=a.layer,d=c?c.map:null;if(c&&d){var e;if(b){c={};for(e in a.attributes)c[e]=a.attributes[e];e=OpenLayers.String.format(b,c)}else e=function(){var b="",c;for(c in a.attributes)b+=c+":"+a.attributes[c]+"<br>";return b}();c=a.geometry.getBounds().getCenterLonLat();d&&d.flyTo(c,4E3);e=new Geo.View3D.Popup.FramedCloud("featureInfo",c,null,e,null,!0,Geo.View3D.FeatureManager.onPopupClose);a.popup=e;d.addPopup(e)}};
Geo.View3D.FeatureManager.closeFramedCloud=function(){};Geo.View3D.FeatureManager.onPopupClose=function(){};Geo.View3D.FeatureManager.showTopic=function(){};Geo.View3D.FeatureManager.closeTopic=function(){};
Geo.View3D.Control.Measure.PointInfo=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Point,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(a){var b={};b.coordinates=a.x+","+a.y;var c={longitude:a.x,latitude:a.y,altitude:null,slope:null,aspect:null};this._getMeasureResult("pointAltitude",b,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),
a;c.altitude=a.Result.Value;this._getMeasureResult("pointSlope",b,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),a;c.slope=a.Result.Value;this._getMeasureResult("pointAspect",b,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),a;c.aspect=a.Result.Value;this.onComplete(c)},this))},this))},this))},_onAddPoint:function(){},CLASS_NAME:"Geo.View3D.Control.Measure.PointInfo"});
Geo.View3D.Control.Measure.Distance=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Path,isRealTime:!1,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(a){var b=this._points.join(","),c={};c.coordinates=b;var d={distance:null,surfDistance:null};d.distance=a.getGeodesicLength();this._getMeasureResult("surfaceDistance",c,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),
a;d.surfDistance=a.Result.Value;this.onComplete(d)},this))},_onAddPoint:function(a,b){var c=b.components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),this._points.push(c[d].y);if(!(c.length<=1)&&this.isRealTime){c=this._points.join(",");d={};d.coordinates=c;var e={surfDistance:null};this._getMeasureResult("surfaceDistance",d,OpenLayers.Function.bind(function(a){e.surfDistance=a.Result.Value;this.onAddPoint(e)},this))}},CLASS_NAME:"Geo.View3D.Control.Measure.PointInfo"});
Geo.View3D.Control.Measure.Area=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Polygon,isRealTime:!1,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(a){var b=this._points.join(","),c={};c.coordinates=b;var d={area:null,surfaceArea:null};d.area=a.getGeodesicArea();this._getMeasureResult("surfaceArea",c,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),
a;d.surfaceArea=a.Result.Value;this.onComplete(d)},this))},_onAddPoint:function(a,b){var c=b.components[0].components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),this._points.push(c[d].y);if(!(c.length<=2)&&this.isRealTime){c=this._points.join(",");d={};d.coordinates=c;var e={surfaceArea:null};this._getMeasureResult("surfaceArea",d,OpenLayers.Function.bind(function(a){e.surfaceArea=a.Result.Value;this.onAddPoint(e)},this))}},CLASS_NAME:"Geo.View3D.Control.Measure.Area"});
Geo.View3D.Control.Measure.Volume=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Polygon,height:200,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(a){var b=this._points.join(","),c={};c.coordinates=b;c.subjoin=this.height;var d={height:this.height,geometry:a,volume:null};this._getMeasureResult("volume",c,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),
a;a=a.Result.Value.split(" ");d.volume=a[0];this.onComplete(d)},this))},_onAddPoint:function(a,b){var c=b.components[0].components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),this._points.push(c[d].y);if(!(c.length<=2)&&this.isRealTime){c=this._points.join(",");d={};d.coordinates=c;d.subjoin=this.height;var e={height:this.height,geometry:b,volume:null};this._getMeasureResult("volume",d,OpenLayers.Function.bind(function(a){a=a.Result.Value.split(" ");e.volume=a[0];e.excavate=
a[1];e.fill=a[2];this.onAddPoint(e)},this))}},CLASS_NAME:"Geo.View3D.Control.Measure.Volume"});
Geo.View3D.Control.Measure.Excavate=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Polygon,height:200,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(a){var b=this._points.join(","),c={};c.coordinates=b;c.subjoin=this.height;var d={height:this.height,geometry:a,excavate:null,file:null,volume:null};this._getMeasureResult("volume",c,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),
a;a=a.Result.Value.split(" ");d.volume=a[0];d.excavate=a[1];d.fill=a[2];this.onComplete(d)},this))},_onAddPoint:function(a,b){var c=b.components[0].components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),this._points.push(c[d].y);if(!(c.length<=2)&&this.isRealTime){c=this._points.join(",");d={};d.coordinates=c;d.subjoin=this.height;var e={height:this.height,geometry:b,excavate:null,fill:null,volume:null};this._getMeasureResult("volume",d,OpenLayers.Function.bind(function(a){a=
a.Result.Value.split(" ");e.volume=a[0];e.excavate=a[1];e.fill=a[2];this.onAddPoint(e)},this))}},deactivate:function(){Geo.View3D.Control.prototype.deactivate.apply(this,arguments)&&this._clearBoxLayer();return!0},CLASS_NAME:"Geo.View3D.Control.Measure.Excavate"});
Geo.View3D.Control.Measure.Flood=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Polygon,height:2E3,solidOptions:null,solid:null,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},_measureHandler:function(a){this._result=a={height:this.height,volume:a.Volume,inundatedArea:a.InundatedArea,floodArea:a.FloodArea,floodVolume:a.FloodVolume};this.onAddPoint(a)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(a){var b=this._points.join(","),
c={};c.coordinates=b;c.subjoin=this.height;var d={height:this.height,inundatedArea:null,floodArea:null,floodVolume:null};this._getMeasureResult("floodAnalysis",c,OpenLayers.Function.bind(function(b){if(this._terrainAnalysisService._isException(b))return this.onComplete(b),b;b=b.Result.Value.split(" ");d.inundatedArea=b[0];d.floodArea=b[1];d.floodVolume=b[2];this._drawSolid(a);this.onComplete(d)},this))},_onAddPoint:function(a,b){var c=b.components[0].components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),
this._points.push(c[d].y);if(!(c.length<=2)&&this.isRealTime){c={};c.coordinates=pointsString;c.subjoin=this.height;var e={height:this.height,inundatedArea:null,floodArea:null,floodVolume:null};this._getMeasureResult("floodAnalysis",c,OpenLayers.Function.bind(function(a){a=a.Result.Value.split(" ");e.inundatedArea=a[0];e.floodArea=a[1];e.floodVolume=a[2];this.onComplete(e)},this))}},_drawSolid:function(a){this.solid&&this._clearSolid();this.solid=new Geo.View3D.Layer.Solid(this.id+"_solid",a,this.height,
this.solidOptions);this.map.addLayer(this.solid)},_clearSolid:function(){this.solid&&this.map&&this.map.removeLayer(this.solid)},deactivate:function(){Geo.View3D.Control.prototype.deactivate.apply(this,arguments)&&this._clearSolid();return!0},CLASS_NAME:"Geo.View3D.Control.Measure.Flood"});
Geo.View3D.Control.Measure.Profile=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Path,initialize:function(a,b){Geo.View3D.Control.prototype.initialize.apply(this,[b]);this.serviceUrl=a;this._terrainAnalysisService=new Geo.Service.TAS(this.id+"_service",a);this.callbacks=OpenLayers.Util.extend({point:this._onAddPoint},this.callbacks);this.handlerOptions=this.handlerOptions||{};if(this.handlerType)this.handler=new this.handlerType(this,this.callbacks,this.handlerOptions)},onAddPoint:function(){},
onComplete:function(){},_onComplete:function(){var a=this._points.join(","),b={};b.coordinates=a;var c={heightArray:null};this._getMeasureResult("profileAnalysis",b,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),a;c.heightArray=a.Result.Value;this.onComplete(c)},this))},_onAddPoint:function(a,b){var c=b.components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),this._points.push(c[d].y);c.length==2&&(this._onComplete(),
this.handler.deactivate(),this.handler.activate())},CLASS_NAME:"Geo.View3D.Control.Measure.Profile"});
Geo.View3D.Control.Measure.TwoPointThrough=Geo.Class(Geo.View3D.Control.Measure,{handlerType:Geo.View3D.Handler.Path,initialize:function(){Geo.View3D.Control.Measure.prototype.initialize.apply(this,arguments)},onAddPoint:function(){},onComplete:function(){},_onComplete:function(){var a=this._points.join(","),b={};b.coordinates=a;var c={from:null,to:null,isVisible:null,firstUnseenHeight:null,heightArray:null};this._getMeasureResult("profileAnalysis",b,OpenLayers.Function.bind(function(a){if(this._terrainAnalysisService._isException(a))return this.onComplete(a),
a;c.heightArray=a.Result.Value;c.isVisible=this.getVisible(c.heightArray).isVisible;c.firstUnseenHeight=this.getVisible(c.heightArray).firstUnseenHeight;this.onComplete(c)},this))},_onAddPoint:function(a,b){var c=b.components;this._points=[];for(var d=0;d<c.length;d++)this._points.push(c[d].x),this._points.push(c[d].y);c.length==2&&(this._onComplete(),this.handler.deactivate(),this.handler.activate())},getVisible:function(a){for(var a=a.split(" "),b=a.length,c=!0,d=null,e=0;e<b;e++){var f=Number(a[0])+
(a[b-1]-a[0])/(b-1)*e;e>0&&e<b-1&&c&&a[e]>=f&&(c=!1,d=f)}return{firstUnseenHeight:d,isVisible:c}},CLASS_NAME:"Geo.View3D.Control.Measure.TwoPointThrough"});
Geo.View3D.Control.ModelChoose=Geo.Class(Geo.View3D.Control,{handlerOptions:null,callbacks:{},initialize:function(a){Geo.View3D.Control.prototype.initialize.apply(this,[a]);this.callbacks=OpenLayers.Util.extend({chooseModel:this.chooseModel},this.callbacks);this.handlerOptions=this.handlerOptions||{};this.handler=new Geo.View3D.Handler.ModelChoose(this,this.callbacks,this.handlerOptions)},chooseModel:function(){},CLASS_NAME:"Geo.View3D.Control.ModelChoose"});
Geo.CombineView=Geo.Class({id:null,div:null,map2D:null,map2DOptions:null,map3D:null,map3DOptions:null,currentView:null,viewList:null,defaultView:"2D",defaultLayout:"single",currentLayout:null,center:null,zoom:null,ayncType:"all",layoutList:["single","vertical","horizontal"],EVENT_TYPES:["viewswitch","addlayer","loadlayergroup"],events:null,eventListeners:null,initialize:function(a,b){this.id=OpenLayers.Util.createUniqueID("Geo.CombineView_");this.div=OpenLayers.Util.getElement(a);this.viewList={"2D":{title:"\u4e8c\u7ef4\u89c6\u56fe",
getMapObj:OpenLayers.Function.bind(function(){return this.map2D},this),initFn:OpenLayers.Function.bind(this.initMap2D,this),getInitOptions:OpenLayers.Function.bind(function(){return this.map2DOptions},this)},"3D":{title:"\u4e09\u7ef4\u89c6\u56fe",getMapObj:OpenLayers.Function.bind(function(){return this.map3D},this),initFn:OpenLayers.Function.bind(this.initMap3D,this),getInitOptions:OpenLayers.Function.bind(function(){return this.map3DOptions},this)}};OpenLayers.Util.extend(this,b);this.initLayout();
this.currentView=this.defaultView;var c=this.viewList[this.currentView].initFn,d=this.viewList[this.currentView].getInitOptions();c(d);this.events=new OpenLayers.Events(this,this.div,this.EVENT_TYPES,this.fallThrough,{includeXY:!0});if(this.eventListeners instanceof Object)this.events.on(this.eventListeners)},initMap2D:function(a){if(!this.map2D){var b=document.createElement("div");b.style.height="100%";b.style.width="100%";b.id=this.id+"_map2D";this.div.appendChild(b);this.map2D=new Geo.View2D.Map(b,
a);this.map2D.events.on({move:function(){this.center=this.map2D.getCenter();this.zoom=this.map2D.getZoom()},scope:this})}return!0},initMap3D:function(a){if(!this.map3D){var b=document.createElement("div");b.style.height="100%";b.style.width="100%";b.id=this.id+"_map3D";this.div.appendChild(b);this.map3D=new Geo.View3D.Map(b,a)}return!0},initLayout:function(){},switchView:function(a){if(a!=this.currentView){if(!a||!this.viewList[a])a=this.getNextView(this.currentView);this.viewList[a].mapObj||this.viewList[a].initFn();
this.viewList[this.currentView].getMapObj().div.style.display="none";this.viewList[a].getMapObj().div.style.display="";this.syncView();this.currentView=a;this.events.triggerEvent("viewswitch",{view:a})}},zoomIn:function(){this.getCurrentMapObj().zoomIn()},zoomOut:function(){this.getCurrentMapObj().zoomOut()},setCenter:function(a,b){this.center=a;this.zoom=b;this.getCurrentMapObj().setCenter(a,b)},addLayer:function(a){this.getCurrentMapObj().addLayer(a)},addLayers:function(a){a instanceof Array||(a=
[a]);for(var b=0;b<a.length;b++)this.addLayer(a[b])},loadLayerGroup:function(a){this.getCurrentMapObj().loadLayerGroup(a)},unloadLayerGroup:function(){this.getCurrentMapObj().unloadLayerGroup()},getCurrentMapObj:function(){var a=this.viewList[this.currentView].getMapObj();if(!a)return null;return a},syncView:function(){var a=this.viewList,b=this.currentView;a[b].getMapObj();for(var c in a)if(b!=c){var d=a[c].getMapObj();if(!d)break;d.setCenter(this.center,this.zoom)}},getNextView:function(a){var b=
null,c=null,d=!0,e=!1,f;for(f in this.viewList){d&&(b=f,d=!1);if(e){c=f;break}f===a&&(e=!0)}if(!c)return b;return c},CLASS_NAME:"Geo.CombineView"});
Geo.LayerManager=Geo.Class({map:null,autoUpdateList:!0,isAllLayers:!1,template:{wrapper:"<ul>${layerItemTemplate}</ul>",item:"<li><input type='checkbox' ${visibility} onchange='lm.toggleLayerVisibility(${layerid})' />${layerName}</li>",noLayer:"<li>\u5f53\u524d\u6ca1\u6709\u56fe\u5c42</li>"},ascending:!0,initialize:function(a){OpenLayers.Util.extend(this,a)},setMap:function(a){this.map=a;this._updateLayerList()},getCurrentMapObj:function(){var a=this.map;a.CLASS_NAME=="Geo.CombineView"&&(a=a.getCurrentMapObj());
return a},updateLayerList:function(){},_updateLayerList:function(){var a=this.getLayers();this.map&&this.autoUpdateList&&this.updateLayerList(a)},getLayers:function(){var a=[],b=this.getCurrentMapObj();if(!b)return a;b=b.layers;if(!this.isAllLayers)for(var c=0;c<b.length;c++){var d=b[c];d.displayInLayerSwitcher&&a.push(d)}this.ascending||a.reverse();return a},setOpacity:function(a,b){var c=this.getCurrentMapObj().getLayer(a);c&&c.setOpacity(b);this._updateLayerList()},raisLayer:function(a,b){var c=
this.getCurrentMapObj(),d=c.getLayer(a);d&&c.raiseLayer(d,b);this._updateLayerList()},raisLayerToTop:function(a){var b=this.getCurrentMapObj(),c=b.getLayer(a);if(c)b=b.layers,c=OpenLayers.Util.indexOf(b,c),this.raisLayer(a,b.length-c)},raisLayerToBottom:function(a){var b=this.getCurrentMapObj(),c=b.getLayer(a);c&&(b=0-OpenLayers.Util.indexOf(b.layers,c),this.raisLayer(a,b))},toggleLayerVisibility:function(a){a=this.getCurrentMapObj().getLayer(a);a.setVisibility(!a.getVisibility());this._updateLayerList()},
gotoLayer:function(a){var b=this.getCurrentMapObj(),c=b.getLayer(a);c.gotoCenter?c.gotoCenter():(a=c.CLASS_NAME=="OpenLayers.Layer.WMTS"?c.tileFullExtent:c.maxExtent?c.maxExtent:b.maxExtent,c=b.getZoomForResolution(c.maxResolution?c.maxResolution:b.maxResolution,!0),b.setCenter(a.getCenterLonLat(),c))},removeLayer:function(a){var b=this.getCurrentMapObj();(a=b.getLayer(a))&&b.removeLayer(a);this._updateLayerList()},addLayer:function(a,b){var c=this.getCurrentMapObj(),d=c.CLASS_NAME,a=a.toUpperCase(),
d=Geo.LayerManager.supportService[d][a],e=null;if(d)return e=d(b),c.addOverLayer(e),this._updateLayerList(),!0;return!1},CLASS_NAME:"Geo.LayerManager"});
Geo.LayerManager.supportService={"Geo.View2D.Map":{OGC_WMS:function(a){var b=a.name,c=a.url,d=a.params,e=a.options,f=a.params.layers;if(a.isSeparate){f.split(",");for(var a=[],f=0,g=arrLayers.length;f<g;f++)OpenLayers.Util.extend(d,{layers:arrLayers[f]}),a.push(new OpenLayers.Layer.WMS(b,c,d,e));return a}return new OpenLayers.Layer.WMS(b,c,d,e)},GEO_TILE:function(a){return new Geo.View2D.Layer.GlobeTile(a.name,a.url,a.options)},OGC_WMTS:function(a){return new OpenLayers.Layer.WMTS(a)},GEO_CWMS:function(a){return new Geo.View2D.Layer.CWMS(a.name,
a.url,a.options)}},"Geo.View3D.Map":{OGC_WMS:function(a){var b=a.name,c=a.url,d=a.params,e=a.options,f=a.params.layers;if(a.isSeparate){f.split(",");for(var a=[],f=0,g=arrLayers.length;f<g;f++)OpenLayers.Util.extend(d,{layers:arrLayers[f]}),a.push(new Geo.View3D.Layer.WMS(b,c,d,e));return a}return new Geo.View3D.Layer.WMS(b,c,d,e)},GEO_TILE:function(a){return new Geo.View3D.Layer.GlobeTile(a.name,a.url,a.options)},GEO_TERRAIN:function(a){return new Geo.View3D.Layer.Terrain(a.name,a.url,a.options)},
GEO_MODEL:function(a){return new Geo.View3D.Layer.Model(a.name,a.url,a.options)},OGC_WMTS:function(a){return new Geo.View3D.Layer.WMTS(a.name,a.url,a)},GEO_WTFS:function(a){return new Geo.View3D.Layer.WTFS(a.name,a.url,a.options)}}};
Geo.Analysis.BufferAnalysis=Geo.Class({url:null,type:1,accuracy:32,initialize:function(a,b){this.url=a;OpenLayers.Util.extend(this,b)},_buildPostXML:function(a,b){return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><wps:Execute service="WPS" version="1.0.0" xmlns:gml="http://www.opengis.net/gml" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 ../wpsExecute_request.xsd"><ows:Identifier>Buffer</ows:Identifier><wps:DataInputs><wps:Input><ows:Identifier>InputPolygon</ows:Identifier><wps:Data><wps:ComplexData schema="http://foo.bar/MyComplexValueSchema.xsd" mimeType="text/xml" encoding="UTF-8">'+(new OpenLayers.Format.GML).write(a)+
"</wps:ComplexData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferDistance</ows:Identifier><wps:Data><wps:LiteralData>"+b+"</wps:LiteralData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferType</ows:Identifier><wps:Data><wps:LiteralData>"+this.type+"</wps:LiteralData></wps:Data></wps:Input><wps:Input><ows:Identifier>BufferAccuracy</ows:Identifier><wps:Data><wps:LiteralData>"+this.accuracy+"</wps:LiteralData></wps:Data></wps:Input></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>BufferedPolygon</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:Execute>"},
_getFeaturesCenter:function(a){return this._getFeaturesExtent(a).getCenterLonLat()},_getFeaturesExtent:function(a){a instanceof Array||(a=[a]);var b=null;if(a&&a.length>0)for(var b=new Geo.Bounds,c=null,d=0,e=a.length;d<e;d++)(c=a[d].geometry)&&b.extend(c.getBounds());return b},startAnalysis:function(a,b,c){var d=["m","km","degree"],e=this._getFeaturesCenter(a);if(!c||OpenLayers.Util.indexOf(d,c)==-1)c="m";switch(c){case "km":b*=1E3;case "m":b=this._meterToDegree(b,e)}a=this._buildPostXML(a,b);new OpenLayers.Request.POST({url:this.url,
data:a,scope:this,success:function(a){this.successFn(this._parserResult(a))},failure:this.failFn})},_meterToDegree:function(a,b){return a*(8.99E-6/Math.cos(OpenLayers.Util.rad(b.lat)))},successFn:function(){},failFn:function(){alert("\u7f13\u51b2\u5206\u6790\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4bWPS\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u3002")},_parserResult:function(a){var b=null,b=new OpenLayers.Format.XML;if(!a.responseXML)a.responseXML=b.read(a.responseText);return b=(new OpenLayers.Format.GML).read(a.responseXML)},
CLASS_NAME:"Geo.Analysis.BufferAnalysis"});Geo.Analysis.BufferAnalysis.CAP_ROUND=1;Geo.Analysis.BufferAnalysis.CAP_BUTT=2;Geo.Analysis.BufferAnalysis.CAP_SQUARE=3;
Geo.Analysis.SuperposeAnalysis=Geo.Class({url:null,type:"Intersection",_requestStringTemplate:'<wps:Execute service="WPS" version="1.0.0" xmlns:gml="http://www.opengis.net/gml" xmlns:wps="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:wfs="http://www.opengis.net/wfs" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 ../wpsExecute_request.xsd"><ows:Identifier>${type}</ows:Identifier><wps:DataInputs><wps:Input><ows:Identifier>InputPolygon</ows:Identifier><wps:Data><wps:ComplexData schema="http://foo.bar/MyComplexValueSchema.xsd" mimeType="text/xml" encoding="UTF-8">${dataInputs}</wps:ComplexData></wps:Data></wps:Input></wps:DataInputs><wps:ResponseForm><wps:RawDataOutput><ows:Identifier>BufferedPolygon</ows:Identifier></wps:RawDataOutput></wps:ResponseForm></wps:Execute>',sourceFeatures:null,
targetFeatures:null,initialize:function(a,b){this.url=a;this.sourceFeatures=[];this.targetFeatures=[];OpenLayers.Util.extend(this,b)},_buildRequestString:function(){var a=new OpenLayers.Format.GML,b=a.write(this.sourceFeatures),a=a.write(this.targetFeatures);return OpenLayers.String.format(this._requestStringTemplate,{type:this.type,dataInputs:b+a})},startAnalysis:function(){if(this._checkSet())return!1;var a=this._buildRequestString();new OpenLayers.Request.POST({url:this.url,data:a,scope:this,success:function(a){this.successFn(this._parserResult(a))},
failure:this.failFn})},_checkSet:function(){if(!this.url)return!1;if(!this.sourceFeatures||!this.sourceFeatures.length)return!1;if(!this.targetFeatures||!this.targetFeatures.length)return!1},successFn:function(){},failFn:function(){alert("\u53e0\u7f6e\u5206\u6790\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u68c0\u6d4bWPS\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u3002")},_parserResult:function(a){var b=[],c=new OpenLayers.Format.XML;if(!a.responseXML)a.responseXML=c.read(a.responseText);var d=c.lookupNamespaceURI(a.responseXML,
"gml"),a=c.getElementsByTagNameNS(a.responseXML,d,"FeatureCollection");a.length>0&&(b=c.write(a[0]),b=(new OpenLayers.Format.GML).read(b));return b},CLASS_NAME:"Geo.Analysis.SuperposeAnalysis"});
Geo.Query.WFSQuery=Geo.Class({url:null,featureType:"",maxFeatures:10,filter:null,geometryName:"the_geom",protocol:null,format:null,formatOptions:null,isSeparate:!1,sortBy:null,initialize:function(a,b,c){this.url=a;this.featureType=b;this.format=new OpenLayers.Format.GML;OpenLayers.Util.extend(this,c)},query:function(a,b,c){this.protocol=new OpenLayers.Protocol.WFS({readFormat:this.format,formatOptions:this.formatOptions,propertyNames:this.propertyNames,maxFeatures:this.maxFeatures,url:this.url,geometryName:this.geometryName,
featureType:this.featureType});var a=a||this.filter,d=b||this.successFn,e=c||this.failFn,b=OpenLayers.Function.bind(function(a){a.success()?(a=a.features,this.isSeparate&&(a=this._separateFeatures(a)),d(a)):e()},this);this.response=this.protocol.read({sortBy:this.sortBy,filter:a,callback:b})},getBufferRegion:function(a,b,c){var d=this._getFeaturesCenter(a);switch(c){case "km":b*=1E3;case "m":b=this._meterToDegree(b,d)}return Geo.Geometry.Polygon.createRegularPolygon(a,b,40,360)},_getFeaturesCenter:function(a){return this._getFeaturesExtent(a).getCenterLonLat()},
_getFeaturesExtent:function(a){a instanceof Array||(a=[a]);var b=null;if(a&&a.length>0)for(var b=new Geo.Bounds,c=null,d=0,e=a.length;d<e;d++)(c=a[d].geometry)&&b.extend(c.getBounds());return b},_meterToDegree:function(a,b){return a*(8.99E-6/Math.cos(OpenLayers.Util.rad(b.lat)))},pointQuery:function(a,b,c,d,e){this.query(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:this.geometryName,distance:b||0,distanceUnits:c||"degree",value:a}),d,e)},pathQuery:function(a,b,c,
d,e){this.query(new OpenLayers.Filter.Spatial({type:OpenLayers.Filter.Spatial.DWITHIN,property:this.geometryName,distance:b||0,distanceUnits:c||"degree",value:a}),d,e)},polygonQuery:function(a,b,c,d){this.query(new OpenLayers.Filter.Spatial({type:b?OpenLayers.Filter.Spatial.CONTAINS:OpenLayers.Filter.Spatial.INTERSECTS,property:this.geometryName,value:a}),c,d)},bboxQuery:function(a,b,c){this.query(new Geo.Filter.Spatial({type:OpenLayers.Filter.Spatial.BBOX,property:this.geometryName,value:a}),b,c)},
attributeQuery:function(a,b,c,d,e,f){this.query(new OpenLayers.Filter.Comparison({type:a,property:b,value:c,matchCase:d&&d.matchCase,lowerBoundary:d?d.lowerBoundary:null,upperBoundary:d?d.upperBoundary:null}),e,f)},successFn:function(){},failFn:function(){alert("\u5bf9\u4e0d\u8d77,\u67e5\u8be2\u5931\u8d25,\u8bf7\u67e5\u8be2\u670d\u52a1\u662f\u5426\u6b63\u5e38.")},_separateFeatures:function(a){for(var b={},c=0;c<a.length;c++){var d=a[c],e;e=d.gml?d.gml.featureType:d.type;b[e]||(b[e]=[]);b[e].push(d)}return b},
CLASS_NAME:"Geo.Query.WFSQuery"});
Geo.Query.CatalogQuery=Geo.Class({url:null,failFn:function(){alert("\u5bf9\u4e0d\u8d77\uff0c\u67e5\u8be2\u8bf7\u6c42\u5931\u8d25\uff01\u8bf7\u68c0\u67e5\u8d44\u6e90\u76ee\u5f55\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u3002\n\u5f53\u524d\u670d\u52a1\u5730\u5740\u4e3a\uff1a"+this.url)},initialize:function(a,b){this.url=a;OpenLayers.Util.extend(this,b)},_soapTemplate:'<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xsi:schemaLocation="http://www.opengis.net/ows" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Body>${soapBody}</soapenv:Body></soapenv:Envelope>',_getRecordsTemplate:'<csw:GetRecords service="CSW" version="2.0.2" outputFormat="text/xml" resultType="results" ${outputSchema} xmlns:csw="http://www.opengis.net/cat/csw" xmlns:ogc="http://www.opengis.net/ogc" ${customNamespaces}> <csw:Query typeNames="${typeNames}"><csw:ElementSetName>full</csw:ElementSetName>${constraint}</csw:Query></csw:GetRecords>',
_constraintTemplate:'<csw:Constraint version="2.0.0">${filter}</csw:Constraint>',getResTreeNode:function(a,b,c,d){a&&(a=0);b=new Geo.Filter.Comparison({type:Geo.Filter.Comparison.EQUAL_TO,property:"/geoglobe:ResourceType/geoglobe:kind",value:"CATALOG"});a=new Geo.Filter.Comparison({type:Geo.Filter.Comparison.EQUAL_TO,property:"/geoglobe:ResourceType/geoglobe:parentId",value:a});a=this._makerFilterString(new Geo.Filter.Logical({type:Geo.Filter.Logical.AND,filters:[b,a]}));a=OpenLayers.String.format(this._getRecordsTemplate,
{customNamespaces:'xmlns:geoglobe="http://www.geostar.com.cn/geoglobe"',constraint:a,outputSchema:'outputSchema="geoglobe:ResourceType"',typeNames:"geoglobe:ResourceType"});a=this._wrapToSoapRequest(a);if(!(d instanceof Function))d=this.failFn;b=OpenLayers.Function.bind(function(a){a=this._getBodyFromSoapResponse(a.responseText);OpenLayers.Function.bind(c,this)(a)},this);new OpenLayers.Ajax.Request(this.url,{contentType:"application/xml",method:"post",postBody:a,onSuccess:b,onFailure:d})},searchServices:function(){},
queryMetaData:function(a,b,c,d){a=this._makerFilterString(a);a=OpenLayers.String.format(this._getRecordsTemplate,{customNamespaces:' xmlns:smmd="http://data.sbsm.gov.cn/smmd/2007"',constraint:a,outputSchema:' outputSchema="smmd:Metadata"',typeNames:"smmd:Metadata"});a=this._wrapToSoapRequest(a);if(!(d instanceof Function))d=this.failFn;b=OpenLayers.Function.bind(function(a){a=this._getBodyFromSoapResponse(a.responseText);OpenLayers.Function.bind(c,this)(a)},this);new OpenLayers.Ajax.Request(this.url,
{contentType:"application/xml",method:"post",postBody:a,onSuccess:b,onFailure:d})},_wrapToSoapRequest:function(a){return OpenLayers.String.format(this._soapTemplate,{soapBody:a})},_getBodyFromSoapResponse:function(a){typeof a=="string"&&(a=OpenLayers.Format.XML.prototype.read.apply(this,[a]));if(a&&a.nodeType==9)a=a.documentElement;if(a.nodeName=="SOAP-ENV:Envelope")return a.childNodes[0].childNodes[0];return a},_makerFilterString:function(a){a||(a=new Geo.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE,
property:"/smmd:Metadata/smmd:mdFileID",value:"*"}));a=(new OpenLayers.Format.Filter).write(a).xml;return constraintString=OpenLayers.String.format(this._constraintTemplate,{filter:a})},CLASS_NAME:"Geo.Query.CatalogQuery"});
OpenLayers.Format.CSWGetRecords.v2_0_0=Geo.Class(OpenLayers.Format.CSWGetRecords.v2_0_2,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",csw:"http://www.opengis.net/cat/csw",dc:"http://purl.org/dc/elements/1.1/",dct:"http://purl.org/dc/terms/",ows:"http://www.opengis.net/ows",geoglobe:"http://www.geostar.com.cn/geoglobe",smmd:"http://data.sbsm.gov.cn/smmd/2007"},version:"2.0.0",schemaLocation:"http://www.opengis.net/cat/csw http://schemas.opengis.net/csw/CSW-discovery.xsd",
readers:{csw:{GetRecordsResponse:function(a,b){b.records=[];this.readChildNodes(a,b);var c=this.getAttributeNS(a,"","version");if(c!="")b.version=c},RequestId:function(a,b){b.RequestId=this.getChildValue(a)},SearchStatus:function(a,b){b.SearchStatus={};var c=this.getAttributeNS(a,"","timestamp");if(c!="")b.SearchStatus.timestamp=c},SearchResults:function(a,b){this.readChildNodes(a,b);for(var c=a.attributes,d={},e=0,f=c.length;e<f;++e)d[c[e].name]=c[e].name=="numberOfRecordsMatched"||c[e].name=="numberOfRecordsReturned"||
c[e].name=="nextRecord"?parseInt(c[e].nodeValue):c[e].nodeValue;b.SearchResults=d}},dc:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]instanceof Array||(b[c]=[]);for(var d={},e=a.attributes,f=0,g=e.length;f<g;++f)d[e[f].name]=e[f].nodeValue;d.value=this.getChildValue(a);b[c].push(d)}},dct:{"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]instanceof Array||(b[c]=[]);b[c].push(this.getChildValue(a))}},ows:{WGS84BoundingBox:function(a,b){if(!(b.BoundingBox instanceof
Array))b.BoundingBox=[];for(var c=this.getChildValue(this.getElementsByTagNameNS(a,this.namespaces.ows,"LowerCorner")[0]).split(" ",2),d=this.getChildValue(this.getElementsByTagNameNS(a,this.namespaces.ows,"UpperCorner")[0]).split(" ",2),c={value:[parseFloat(c[0]),parseFloat(c[1]),parseFloat(d[0]),parseFloat(d[1])]},d=a.attributes,e=0,f=d.length;e<f;++e)c[d[e].name]=d[e].nodeValue;b.BoundingBox.push(c)},BoundingBox:function(a,b){this.readers.ows.WGS84BoundingBox.apply(this,[a,b])}},geoglobe:{ResourceType:function(a,
b){var c={type:"ResourceType"};this.readChildNodes(a,c);b.records.push(c)},"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]=this.getChildValue(a)}},smmd:{Metadata:function(a,b){var c={type:"Metadata"};this.readChildNodes(a,c);b.records.push(c)},"*":function(a,b){var c=a.localName||a.nodeName.split(":").pop();b[c]=this.getChildValue(a)}}},CLASS_NAME:"OpenLayers.Format.CSWGetRecords.v2_0_0"});
Geo.Service=Geo.Class({name:null,url:null,version:null,userid:"test@liferay.com",initialize:function(a,b,c){this.name=a;this.url=b;OpenLayers.Util.extend(this,c)},getCapabilities:function(){},isExist:function(){},failFn:function(a){alert("\u670d\u52a1\u8bf7\u6c42\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u670d\u52a1\u662f\u5426\u6b63\u5e38\u8fd0\u884c\u6216\u8bf7\u6c42\u5730\u5740\u662f\u5426\u6b63\u786e\u3002\n\u8bf7\u6c42\u5730\u5740\uff1a"+this.url+"\n\u64cd\u4f5c\u7c7b\u578b\uff1a"+a)},_parseToXML:function(a){var b=
a.responseXML;if(!b||!b.documentElement)b=a.responseText;return(new OpenLayers.Format.XML).read(b)},_checkIsError:function(a){if((new OpenLayers.Format.XML).read(a).selectNodes("ServiceExceptionReport").length>0)return this._parseToJSON(a);return null},_isException:function(a){if(a&&a.ServiceExceptionReport)return!0;return!1},_parseToJSON:function(a){return(new Geo.Util.Format.XML2JSON).read(a)},CLASS_NAME:"Geo.Service"});
Geo.Service.GlobeTile=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c=this.url+"/GetCapabilities";b||(b=function(){this.failFn("GetCapabilities")});OpenLayers.loadURL(c,null,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url+"/GetCapabilities",scope:this,async:!1,success:function(){a=!0}});return a},CLASS_NAME:"Geo.Service"});
Geo.Service.Bus=Geo.Class(Geo.Service,{initialize:function(a,b,c){this.name=a;this.url=b;OpenLayers.Util.extend(this,c)},getCapabilities:function(a,b){var c=this.url,d={REQUEST:"GetCapabilities"};b||(b=function(){this.failFn(d.REQUEST)});OpenLayers.loadURL(c,d,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,scope:this,async:!1,success:function(){a=!0}});return a},queryStation:function(a,b,c){var d={REQUEST:"QueryStation"};if(!a.networkName)throw"Error!Not network name for bus query.";
d.NETWORKNAME=a.networkName;if(a.stationId!==null&&a.stationId!==void 0)d.STATIONID=a.stationId;if(a.stationName!==null&&a.stationName!==void 0)d.STATIONNAME=a.stationName;if(a.lineId!==null&&a.lineId!==void 0)d.LINEID=a.lineId;if(a.lineName!==null&&a.lineName!==void 0)d.LINENAME=a.lineName;if(a.coordinate!==null&&a.coordinate!==void 0)d.COORDINATE=a.coordinate;if(a.bbox!==null&&a.bbox!==void 0)d.BOX=a.bbox;OpenLayers.Request.GET({url:this.url,params:d,scope:this,success:function(a){a=this._parserFeatures(a.responseText);
b(a)},failure:c})},queryLine:function(a,b,c){var d={REQUEST:"QueryLine"};if(!a.networkName)throw"Error!Not network name for bus query.";d.NETWORKNAME=a.networkName;if(a.lineName!==null&&a.lineName!==void 0)d.LINENAME=a.lineName;if(a.lineId!==null&&a.lineId!==void 0)d.LINEID=a.lineId;if(a.stationName!==null&&a.stationName!==void 0)d.STATIONNAME=a.stationName;if(a.stationId!==null&&a.stationId!==void 0)d.STATIONID=a.stationId;if(a.coordinate!==null&&a.coordinate!==void 0)d.COORDINATE=a.coordinate;if(a.bbox!==
null&&a.bbox!==void 0)d.BOX=a.bbox;OpenLayers.Request.GET({url:this.url,params:d,scope:this,success:function(a){a=this._parserFeatures(a.responseText);b(a)},failure:c})},queryChange:function(a,b,c){var d={REQUEST:"QueryChange"};if(!a.networkName)throw"Error!Not network name for bus query.";d.NETWORKNAME=a.networkName;if(a.startStationId!==null&&a.startStationId!==void 0)d.STARTSTATIONID=a.startStationId;if(a.endStationId!==null&&a.endStationId!==void 0)d.ENDSTATIONID=a.endStationId;if(a.startCoordinate!==
null&&a.startCoordinate!==void 0)d.STARTCOORDINATE=a.startCoordinate;if(a.endCoordinate!==null&&a.endCoordinate!==void 0)d.ENDCOORDINATE=a.endCoordinate;if(a.maxDepth!==null&&a.maxDepth!==void 0)d.MAXDEPTH=a.maxDepth;if(a.maxCost!==null&&a.maxCost!==void 0)d.MAXCOST=a.maxCost;if(a.maxSolutions!==null&&a.maxSolutions!==void 0)d.MAXSOLUTIONS=a.maxSolutions;OpenLayers.Request.GET({url:this.url,params:d,scope:this,success:function(a){for(var c=[],a=(a.responseXML.documentElement?a.responseXML:format.read(a.responseText)).selectNodes("/Features/FeatureCollection"),
d=new OpenLayers.Format.XML,h=0;h<a.length;h++){var i=this._parserFeatures(d.write(a[h]));c.push(i)}b(c)},failure:c})},_getGeometryType:function(){return"polygon"},_pagingToString:function(a,b){b=b||this.maxPerPage;return"<numPerPage>"+b+"</numPerPage><curPage>"+(a||1)+"</curPage>"},_orderByToString:function(a){return a?"<orderBy><PropertyName>"+a+"</PropertyName></orderBy>":""},_geometryToString:function(){return'<geometry><Polygon><outerBoundaryIs><LinearRing><coordinates decimal="." cs="," ts=" ">20,30 21,41 52,42 53,33 20,30</coordinates></LinearRing></outerBoundaryIs></Polygon></geometry>'},
_stringToGeometry:function(){return Geo.Geometry.Polygon.createRegularPolygon(new Geo.Geometry.Point(Math.random()*360-160,Math.random()*90-70),Math.round(Math.random()*20),Math.round(Math.random()*10))},_parserGetcapabilities:function(a){return a},_parserFeatures:function(a){var b=new OpenLayers.Format.GML;b.gmlns="*";return b.read(a)},_parserSuccessResult:function(a){return(new Geo.Util.Format.XML2JSON).read(a)},_parseToXML:function(a){var b=a.responseXML;if(!b||!b.documentElement)b=a.responseText;
return(new OpenLayers.Format.XML).read(b)},_parseToJSON:function(a){return(new Geo.Util.Format.XML2JSON).read(a)},CLASS_NAME:"Geo.Service.Bus"});
Geo.Service.Plot=Geo.Class(Geo.Service,{maxPerPage:100,initialize:function(a,b,c){this.name=a;this.url=b;OpenLayers.Util.extend(this,c)},getCapabilities:function(a,b){OpenLayers.loadURL(this.url,{REQUEST:"GetCapabilities"},this,function(b){b=this._parseToXML(b);a(b)},b)},addClasses:function(a,b,c){var d={REQUEST:"AddClasses",userid:this.userid},e=this.url,a=OpenLayers.String.format("<AddClasses><Feature><name>${className}</name><parentid>${parentId}</parentid><description>${description}</description><pictureurl>${pictureUrl}</pictureurl></Feature></AddClasses>",
{className:a.className,parentId:a.parentId,description:a.description,pictureUrl:a.pictureUrl});OpenLayers.Request.POST({url:e,params:d,scope:this,data:a,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},deleteClasses:function(a,b,c){var d={REQUEST:"DeleteClasses",userid:this.userid},a=OpenLayers.String.format("<FeatureCollection><Feature><id>${classId}</id></Feature></FeatureCollection>",{classId:a.classId}),e=this.url+"?"+OpenLayers.Util.getParameterString(d);OpenLayers.Request.POST({url:e,
params:d,scope:this,data:a,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},updateClasses:function(a,b,c){var d={REQUEST:"UpdateClasses",userid:this.userid},e=a.name,f=a.description,g=a.pictureUrl,a=OpenLayers.String.format("<FeatureCollection><Feature><id>${classId}</id>${name}${description}${pictureUrl}</Feature></FeatureCollection>",{classId:a.classId,name:function(){return e===null||e===void 0?"":"<name>"+e+"</name>"},description:function(){return f===null||f===void 0?
"":"<description>"+f+"</description>"},pictureUrl:function(){return g===null||g===void 0?"":"<pictureurl>"+g+"</pictureurl>"}});OpenLayers.Request.POST({url:this.url,params:d,scope:this,data:a,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},queryClasses:function(a,b,c){var d={REQUEST:"QueryClasses",userid:this.userid},e=this.url,f=this._filterToString(a.filter),f=OpenLayers.String.format("<FeatureCollection><Query>${pagingInfo}${filter}${orderBy}</Query></FeatureCollection>",
{pagingInfo:OpenLayers.Function.bind(function(){return this._pagingToString(a.maxPerPage,a.currentPage)},this),filter:f,orderBy:OpenLayers.Function.bind(function(){if(a.orderBy===void 0)return"";return this._orderByToString(a.orderBy.property,a.orderBy.type)},this)});OpenLayers.Request.POST({url:e,params:d,scope:this,data:f,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},publishFeatures:function(a,b,c){var d={REQUEST:"PublishFeatures",userid:this.userid},e=this.url,a=OpenLayers.String.format("<FeatureCollection><Feature><BOOKMARKID>${bookmarkId}</BOOKMARKID><TYPE>${type}</TYPE></Feature></FeatureCollection>",
{bookmarkId:a.bookmarkId,type:a.type});OpenLayers.Request.POST({url:e,params:d,scope:this,data:a,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},approvalFeatures:function(a,b,c){var d={REQUEST:"ApprovalFeatures",userid:this.userid,passresult:"pass"},e=this.url,a=OpenLayers.String.format("<FeatureCollection><Feature><BOOKMARKID>${bookmarkId}</BOOKMARKID><TYPE>${type}</TYPE></Feature></FeatureCollection>",{bookmarkId:a.bookmarkId,type:a.type});OpenLayers.Request.POST({url:e,
params:d,scope:this,data:a,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},addFeatures:function(a,b,c){if(a.sortType===null&&a.sortType===void 0)throw"Error!Not sortType of class.";var d=Geo.Math.uuid();a.bookmarkId=d;this.updateFeatures(a,b,c)},updateFeatures:function(a,b,c){var d=OpenLayers.String.format("<Feature>${featureId}${sortId}${sortType}${bookmarkId}${type}${iconpath}${brief}${linecolor}${linewidth}${fillcolor}${opacity}${title}${status}${height}${pitching}${geometry}</Feature>",
{featureId:function(){return a.featureId===null||a.featureId===void 0?"":"<FEATUREID>"+a.featureId+"</FEATUREID>"},sortId:function(){return a.sortId===null||a.sortId===void 0?"":"<SORTID>"+a.sortId+"</SORTID>"},sortType:function(){return a.sortType===null||a.sortType===void 0?"":"<SORTTYPE>"+a.sortType+"</SORTTYPE>"},bookmarkId:function(){return a.bookmarkId===null||a.bookmarkId===void 0?"":"<BOOKMARKID>"+a.bookmarkId+"</BOOKMARKID>"},title:function(){return a.title===null||a.title===void 0?"":"<TITLE>"+
a.title+"</TITLE>"},status:function(){return a.status===null||a.status===void 0?"":"<STATUS>"+a.status+"</STATUS>"},height:function(){return a.height===null||a.height===void 0?"":"<HEIGHT>"+a.height+"</HEIGHT>"},pitching:function(){return a.pitching===null||a.pitching===void 0?"":"<PITCHING>"+a.pitching+"</PITCHING>"},brief:OpenLayers.Function.bind(function(){return a.brief===null||a.brief===void 0?"":"<BRIEF>"+a.brief+"</BRIEF>"},this),type:OpenLayers.Function.bind(function(){return a.type===null||
a.type===void 0?"":"<TYPE>"+a.type+"</TYPE>"},this),linecolor:OpenLayers.Function.bind(function(){return a.linecolor===null||a.linecolor===void 0?"":"<LINECOLOR>"+a.linecolor+"</LINECOLOR>"},this),iconpath:OpenLayers.Function.bind(function(){return a.iconpath===null||a.iconpath===void 0?"":"<ICONPATH>"+a.iconpath+"</ICONPATH>"},this),linewidth:OpenLayers.Function.bind(function(){return a.linewidth===null||a.linewidth===void 0?"":"<LINEWIDTH>"+a.linewidth+"</LINEWIDTH>"},this),fillcolor:OpenLayers.Function.bind(function(){return a.fillcolor===
null||a.fillcolor===void 0?"":"<FILLCOLOR>"+a.fillcolor+"</FILLCOLOR>"},this),opacity:OpenLayers.Function.bind(function(){return a.opacity===null||a.opacity===void 0?"":"<OPACITY>"+a.opacity+"</OPACITY>"},this),geometry:OpenLayers.Function.bind(function(){return a.geometry===null||a.geometry===void 0?"":this._geometryToString(a.geometry)},this)});OpenLayers.Request.POST({url:this.url,params:{REQUEST:"UpdateFeatures",userid:this.userid},scope:this,data:"<FeatureCollection>"+d+"</FeatureCollection>",
success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},deleteFeatures:function(a,b,c){var d={REQUEST:"DeleteFeatures",userid:this.userid},e=this.url,a=OpenLayers.String.format("<FeatureCollection><Feature><BOOKMARKID>${bookmarkId}</BOOKMARKID><TYPE>${type}</TYPE></Feature></FeatureCollection>",{bookmarkId:a.bookmarkId,type:a.type});OpenLayers.Request.POST({url:e,params:d,scope:this,data:a,success:function(a){a=this._parseToJSON(a.responseText);b(a)},failure:c})},queryFeatures:function(a,
b,c){var d={REQUEST:"QueryFeatures",userid:this.userid},e=this.url,f=OpenLayers.String.format("<FeatureCollection><Query>${pagingInfo}<requestType>${requestType}</requestType>${orderBy}${filter}</Query></FeatureCollection>",{pagingInfo:OpenLayers.Function.bind(function(){return this._pagingToString(a.maxPerPage,a.currentPage)},this),classcode:a.classcode,filter:OpenLayers.Function.bind(function(){return this._filterToString(a.filters)},this),orderBy:OpenLayers.Function.bind(function(){if(a.orderBy===
void 0)return"";return this._orderByToString(a.orderBy.property,a.orderBy.type)},this),requestType:a.requestType});OpenLayers.Request.POST({url:e,params:d,scope:this,data:f,success:function(a){a=this._parserFeatures(a.responseText);b(a)},failure:c})},_getGeometryType:function(a){return{"OpenLayers.Geometry.Point":"point","OpenLayers.Geometry.LineString":"line","OpenLayers.Geometry.Polygon":"polygon"}[a.CLASS_NAME]},_filterToString:function(a){if(!a)return"";var b="";a instanceof Array||(a=[a]);for(var c=
0;c<a.length;c++)b+="<Filter><"+a[c].type+"><PropertyName>"+a[c].propertyName+"</PropertyName><Literal>"+a[c].propertyValue+"</Literal></"+a[c].type+">",b+="</Filter>";return b},_pagingToString:function(a,b){b=b||this.maxPerPage;return"<numPerPage>"+b+"</numPerPage><curPage>"+(a||1)+"</curPage>"},_orderByToString:function(a,b){var c;return a?"<orderBy><PropertyName>"+a+"</PropertyName><OrderType>"+b+"</OrderType></orderBy>":""},_geometryToString:function(a){return"<geometry>"+(new OpenLayers.Format.GML).buildGeometryNode(a).xml+
"</geometry>"},_parserGetcapabilities:function(a){return a},_parserFeatures:function(a){var b=new OpenLayers.Format.GML;b.gmlns="*";b.featureName="featureMember";return b.read(a)},_parserSuccessResult:function(a){return(new Geo.Util.Format.XML2JSON).read(a)},_parseToXML:function(a){return(new OpenLayers.Format.XML).read(a.responseText)},_parseToJSON:function(a){return(new Geo.Util.Format.XML2JSON).read(a)},CLASS_NAME:"Geo.Service.Plot"});
Geo.Service.ShortestPath=Geo.Class(Geo.Service,{initialize:function(a,b,c){this.name=a;this.url=b;OpenLayers.Util.extend(this,c)},getCapabilities:function(a,b){OpenLayers.loadURL(this.url,{REQUEST:"GetCapabilities"},this,a,b)},shortestPath:function(a,b,c){OpenLayers.loadURL(this.url,{REQUEST:"ShortestPath",STARTCOORD:a.start,ENDCOORD:a.end,NETWORKNAME:a.network},this,function(a){a=this._parseShortestPath(a);b(a)},c)},_parseShortestPath:function(a){var b=new OpenLayers.Format.XML;if(!a.responseXML)a.responseXML=
b.read(a.responseText);b=new OpenLayers.Format.GML;b.gmlns="*";return b.read(a.responseXML)},_parseCapabilities:function(){},CLASS_NAME:"Geo.Service.ShortestPath"});
Geo.Service.TAS=Geo.Class(Geo.Service,{initialize:function(a,b,c){this.name=a;this.url=b;OpenLayers.Util.extend(this,c)},getCapabilities:function(a,b){OpenLayers.loadURL(this.url,{REQUEST:"GetCapabilities",VERSION:"1.0.0",SERVICE:"TAS"},null,a,b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities",VERSION:"1.0.0",SERVICE:"TAS"},scope:this,async:!1,success:function(){a=!0}});return a},pointAltitude:function(a,b,c){this._sendRequest("PointAltitude",a,
b,c)},pointSlope:function(a,b,c){this._sendRequest("PointSlope",a,b,c)},pointAspect:function(a,b,c){this._sendRequest("PointAspect",a,b,c)},surfaceArea:function(a,b,c){this._sendRequest("SurfaceArea",a,b,c)},volume:function(a,b,c){this._sendRequest("Volume",a,b,c)},surfaceDistance:function(a,b,c){this._sendRequest("SurfaceDistance",a,b,c)},profileAnalysis:function(a,b,c){this._sendRequest("ProfileAnalysis",a,b,c)},contourAnalysis:function(a,b,c){this._sendRequest("ContourAnalysis",a,b,c)},topPoint:function(a,
b,c){this._sendRequest("TopPoint",a,b,c)},singlePointVisiable:function(a,b,c){this._sendRequest("SinglePointVisiable",a,b,c)},floodAnalysis:function(a,b,c){this._sendRequest("FloodAnalysis",a,b,c)},topLowPoint:function(a,b,c){this._sendRequest("TopLowPoint",a,b,c)},getMetaData:function(a,b,c){this._sendRequest("GetMetaData",options,b,c)},_sendRequest:function(a,b,c,d){var e=this.url,f=b.layerLevel,g=b.layerName,h=b.pointCount,i=this._convertRadian(b.coordinates);OpenLayers.loadURL(e,{REQUEST:a,LAYERLEVEL:f,
LAYERNAME:g,POINTCOUNT:h,COORDINATES:i,SUBJOIN:b.subjoin||0},this,function(a){a=this._parseResult(a);c(a)},d)},_convertRadian:function(a){for(var a=a.split(","),b=0;b<a.length;b++)a[b]=a[b]*3.1415926/180;return a.join(",")},_countCoord:function(a){return a.split(",").length/2},_parseResult:function(a){var b=this._checkIsError(a.responseText);if(!b)return(new Geo.Util.Format.XML2JSON).read(a.responseText);return b},CLASS_NAME:"Geo.Service.TAS"});
Geo.Service.WPS=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c=this.url+"/GetCapabilities";b||(b=function(){this.failFn("GetCapabilities")});OpenLayers.loadURL(c,null,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url+"/GetCapabilities",scope:this,async:!1,success:function(){a=!0}});return a},describeProcess:function(a,b,c){var a=OpenLayers.String.format('<DescribeProcess xmlns="http://www.opengis.net/wps/1.0.0" xmlns:ows="http://www.opengis.net/ows/1.1" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.opengis.net/wps/1.0.0 ../wpsDescribeProcess_request.xsd" service="WPS" version="1.0.0" language="en-CA"><ows:Identifier>${process}</ows:Identifier></DescribeProcess>',
{process:a}),d=this.url+"/DescribeProcess";c||(c=function(){this.failFn("DescribeProcess")});new OpenLayers.Request.POST({url:d,data:a,scope:this,success:b,failure:c})},execute:function(a,b,c){var d=this.url+"/Execute";c||(c=function(){this.failFn("Execute")});new OpenLayers.Request.POST({url:d,data:a,scope:this,success:b,failure:c})},CLASS_NAME:"Geo.Service.WPS"});
Geo.Service.WFS=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c=this.url,d={REQUEST:"GetCapabilities",SERVICE:"WFS",VERSION:"1.0.0"};b||(b=function(){this.failFn(d.REQUEST)});OpenLayers.loadURL(c,d,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities",SERVICE:"WFS"},scope:this,async:!1,success:function(){a=!0}});return a},describeFeatureType:function(a,
b,c){OpenLayers.Util.applyDefaults(a,{service:"WFS",version:"1.0.0",request:"DescribeFeatureType"});c||(c=function(){this.failFn(a.REQUEST)});OpenLayers.loadURL(url,a,this,function(a){b(a)},c)},getFeature:function(a,b,c){OpenLayers.Util.applyDefaults(a,{service:"WFS",version:"1.0.0",request:"GetFeature"});c||(c=function(){this.failFn(a.REQUEST)});OpenLayers.loadURL(url,a,this,function(a){b(a)},c)},CLASS_NAME:"Geo.Service.WFS"});
Geo.Service.WMS=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c=this.url,d={REQUEST:"GetCapabilities",SERVICE:"WMS"};b||(b=function(){this.failFn(d.REQUEST)});OpenLayers.loadURL(c,d,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities",SERVICE:"WMS"},scope:this,async:!1,success:function(){a=!0}});return a},getMap:function(a){OpenLayers.Util.applyDefaults(a,
{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",srs:"EPSG:4326",exceptions:"application/vnd.ogc.se_inimage",format:"image/jpeg"});a=OpenLayers.Util.getParameterString(a);return OpenLayers.Util.urlAppend(url,a)},CLASS_NAME:"Geo.Service.WMS"});
Geo.Service.WMTS=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c=this.url,d={REQUEST:"GetCapabilities",SERVICE:"WMTS"};b||(b=function(){this.failFn(d.REQUEST)});OpenLayers.loadURL(c,d,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities",SERVICE:"WMTS"},scope:this,async:!1,success:function(){a=!0}});return a},getTile:function(a){OpenLayers.Util.applyDefaults(a,
{service:"WMTS",version:"1.0.0",request:"GetTile",format:"image/png"});a=OpenLayers.Util.getParameterString(a);return OpenLayers.Util.urlAppend(url,a)},CLASS_NAME:"Geo.Service.WMTS"});
Geo.Service.WCS=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c=this.url,d={REQUEST:"GetCapabilities",SERVICE:"WCS"};b||(b=function(){this.failFn(d.REQUEST)});OpenLayers.loadURL(c,d,this,function(b){a(b)},b)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities",SERVICE:"WCS"},scope:this,async:!1,success:function(){a=!0}});return a},describeCoverage:function(a,b,c){OpenLayers.Util.applyDefaults(a,
{SERVICE:"WCS",VERSION:"1.0.0",REQUEST:"DescribeCoverage"});c||(c=function(){this.failFn(a.REQUEST)});OpenLayers.loadURL(url,a,this,function(a){b(a)},c)},getCoverage:function(a,b,c){OpenLayers.Util.applyDefaults(a,{SERVICE:"WCS",VERSION:"1.1.2",REQUEST:"GetCoverage"});c||(c=function(){this.failFn(a.REQUEST)});OpenLayers.loadURL(url,a,this,function(a){b(a)},c)},CLASS_NAME:"Geo.Service.WCS"});
Geo.Service.CSW=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){var c;c=OpenLayers.String.format(this._soapTemplate,{soapBody:'<csw:GetCapabilities service="CSW" xmlns:csw="http://www.opengis.net/cat/csw" xmlns:ows="http://www.opengis.net/ows"><ows:AcceptVersions><ows:Version>2.0.2</ows:Version></ows:AcceptVersions><ows:AcceptFormats><ows:OutputFormat>text/xml</ows:OutputFormat></ows:AcceptFormats></csw:GetCapabilities>'});
b||(b=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,data:c,scope:this,success:a,failure:b})},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:{REQUEST:"GetCapabilities",SERVICE:"CSW"},scope:this,async:!1,success:function(){a=!0}});return a},getRecords:function(a,b,c){a=OpenLayers.String.format(this._getRecordsTemplate,{});c||(c=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,data:a,scope:this,success:b,failure:c})},_getRecordsTemplate:'<?xml version="1.0" encoding="UTF-8"?><csw:GetRecords service="CSW" version="2.0.2" xmlns:csw="http://www.opengis.net/cat/csw" xmlns:ogc="http://www.opengis.net/ogc" xmlns:smmd="http://data.sbsm.gov.cn/smmd/2007" outputFormat="text/xml" resultType="results" outputSchema="smmd:Metadata" startPosition="1" maxRecords="10"><csw:Query typeNames="smmd:Metadata"> <csw:ElementSetName>full</csw:ElementSetName> <csw:Constraint version="2.0.0"><ogc:Filter> <ogc:PropertyIsLike wildCard="*" singleChar="_" escape="\\"><ogc:PropertyName>/smmd:Metadata/smmd:mdFileID</ogc:PropertyName><ogc:Literal>*</ogc:Literal></ogc:PropertyIsLike></ogc:Filter></csw:Constraint></csw:Query></csw:GetRecords>',
_soapTemplate:'<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xsi:schemaLocation="http://www.opengis.net/ows" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"><soapenv:Body>${soapBody}</soapenv:Body></soapenv:Envelope>',getRecordById:function(a,b,c){a={request:a.request?a.request:"getRecordById",id:a.id?a.id:"",service:a.service?a.service:"CSW",version:a.version?a.version:"2.0.2",outputFormat:a.outputFormat?a.outputFormat:"Application/xml",outputSchema:a.outputSchema?
a.outputSchema:"http://opengis.net/cat/csw/2.0.2",elementSetName:a.elementSetName?a.elementSetName:"summary"};a=OpenLayers.String.format('<csw:GetRecordById service="${service}" xmlns:csw="http://www.opengis.net/cat/csw" version="${version}"><csw:Id>${id}</csw:Id><csw:ElementSetName typeNames="smmd:Metadata">${elementSetName}</csw:ElementSetName></csw:GetRecordById >',{id:a.id,service:a.service,version:a.version,elementSetName:a.elementSetName});c||(c=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,
data:a,scope:this,success:b,failure:c})},describeRecord:function(a,b,c){a={request:a.request?a.request:"describeRecord",service:a.service?a.service:"CSW",version:a.version?a.version:"2.0.2",nameSpace:a.nameSpace?a.nameSpace:"",typeName:a.typeName?a.typeName:"smmd:Metadata",outputSchema:a.outputSchema?a.outputSchema:"application/xml",schemaLanguage:a.schemaLanguage?a.schemaLanguage:"XMLSCHEMA"};a=OpenLayers.String.format('<csw:DescribeRecord service="${service}" xmlns:csw="http://www.opengis.net/cat/csw" version="${version}"><csw:TypeName>${typeName}</csw:TypeName></csw:DescribeRecord >',
{service:a.service,version:a.version,typeName:a.typeName});c||(c=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,data:a,scope:this,success:b,failure:c})},getDomain:function(a,b,c){var d={request:a.request?a.request:"describeRecord",service:a.service?a.service:"CSW",version:a.version?a.version:"2.0.2",propertyName:a.propertyName?a.propertyName:"",parameterName:a.parameterName?a.parameterName:""},e='<csw:GetDomain service="${service}" xmlns:csw="http://www.opengis.net/cat/csw" version="${version}">';
a.propertyName&&(e+="<csw:PropertyName>${propertyName}</csw:PropertyName>");a.parameterName&&(e+="<csw:ParameterName>${parameterName}</csw:ParameterName>");e+="</csw:GetDomain >";a=OpenLayers.String.format(e,{service:d.service,version:d.version,propertyName:d.propertyName,parameterName:d.parameterName});c||(c=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,data:a,scope:this,success:b,failure:c})},transaction:function(a,b,c){var a={request:a.request?a.request:"transaction",service:a.service?
a.service:"CSW",version:a.version?a.version:"2.0.2",transaction:a.transaction?a.transaction:"",transactionType:a.transactionType?a.transactionType:"",requestId:a.requestId?a.requestId:0,verboseResponse:a.verboseResponse?a.verboseResponse:!1,md_metaData:a.md_metaData?a.md_metaData:"",typeName:a.typeName?a.typeName:"",constraintLanguage:a.constraintLanguage?a.constraintLanguage:"",constraint_Language_version:a.constraint_Language_version?a.constraint_Language_version:"",constraint:a.constraint?a.constraint:
"",handle:a.handle?a.handle:0},d="",e="";switch(a.transactionType){case "Insert":d+='<csw:Transaction xmlns:csw="http://www.opengis.net/cat/csw" version="${version}" service="${service}"><csw:Insert xmlns:smmd="http://data.sbsm.gov.cn/smmd/2007" xmlns:wrs="http://www.opengis.net/cat/wrs/1.0" xmlns:gco="http://www.isotc211.org/2005/gco" xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:srv="http://www.isotc211.org/2005/srv" xmlns:gml="http://www.opengis.net/gml" xmlns:gmx="http://www.isotc211.org/2005/gmx" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">${md_metaData}</csw:Insert></csw:Transaction>';
e=OpenLayers.String.format(d,{service:a.service,version:a.version,md_metaData:a.md_metaData});break;case "Update":d+='<csw:Transaction service="${service}" version="${version}" xmlns:csw="http://www.opengis.net/cat/csw"><csw:Update xmlns:srv="http://www.isotc211.org/2005/srv" xmlns:gml="http://www.opengis.net/gml" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:gmd="http://www.isotc211.org/2005/gmd" xmlns:rim="urn:oasis:names:tc:ebxml-regrep:xsd:rim:3.0" xmlns:wrs="http://www.opengis.net/cat/wrs/1.0" xmlns:gco="http://www.isotc211.org/2005/gco" xmlns:gmx="http://www.isotc211.org/2005/gmx" xmlns:ogc="http://www.opengis.net/ogc" xmlns:smmd="http://data.sbsm.gov.cn/smmd/2007">${md_metaData}${constraint}</csw:Update></csw:Transaction>';
e=OpenLayers.String.format(d,{service:a.service,version:a.version,md_metaData:a.md_metaData,constraint:a.constraint});break;case "Delete":d+='<csw:Transaction service="${service}" version="${version}" xmlns:smmd="http://data.sbsm.gov.cn/smmd/2007" xmlns:csw="http://www.opengis.net/cat/csw" xmlns:ogc="http://www.opengis.net/ogc"><csw:Delete typeName="${typeName}">${constraint}</csw:Delete></csw:Transaction>',e=OpenLayers.String.format(d,{service:a.service,version:a.version,typeName:a.typeName,constraint:a.constraint})}c||
(c=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,data:e,scope:this,success:b,failure:c})},harvest:function(a,b,c){var d={request:a.request?a.request:"harvest",service:a.service?a.service:"CSW",version:a.version?a.version:"2.0.2",nameSpace:a.nameSpace?a.nameSpace:"",source:a.source?a.source:"",resourceType:a.resourceType?a.resourceType:"",resourceFormat:a.resourceFormat?a.resourceFormat:"",responseHandler:a.responseHandler?a.responseHandler:"",harvestInterval:a.harvestInterval?
a.harvestInterval:""},e='<csw:Harvest service="${service}" xmlns:csw="http://www.opengis.net/cat/csw" version="${version}">';e+="<csw:Source>${source}</csw:Source>";e+="<csw:ResourceType>${resourceType}</csw:ResourceType>";a.harvestInterval&&(e+="<csw:HarvestInterval>${harvestInterval}</csw:HarvestInterval>");a.responseHandler&&(e+="<csw:ResponseHandler>${responseHandler}</csw:ResponseHandler>");e+="</csw:Harvest>";a=OpenLayers.String.format(e,{service:d.service,version:d.version,source:d.source,
resourceType:d.resourceType,harvestInterval:d.harvestInterval,responseHandler:d.responseHandler});c||(c=function(a){this.failFn(a)});new OpenLayers.Request.POST({url:this.url,data:a,scope:this,success:b,failure:c})},CLASS_NAME:"Geo.Service.CSW"});
Geo.Service.CWMS=Geo.Class(Geo.Service,{initialize:function(){Geo.Service.prototype.initialize.apply(this,arguments)},getCapabilities:function(a,b){b||(b=function(){this.failFn("GetCapabilities")});OpenLayers.loadURL(this.url,null,this,function(b){b=(new OpenLayers.Format.JSON).read(b.responseText);a(b)},b)},getLayerInfo:function(a,b,c){a=this.url.indexOf("/",this.url.length-1)!=-1?this.url+a:this.url+"/"+a;c||(c=function(){this.failFn("GetLayerInfo")});OpenLayers.loadURL(a,null,this,function(a){a=
(new OpenLayers.Format.JSON).read(a.responseText);b(a)},c)},isExist:function(){var a=!1;OpenLayers.Request.GET({url:this.url,params:null,scope:this,async:!1,success:function(){a=!0}});return a},getMap:function(a){a=encodeURIComponent(a.layerId)+"/"+encodeURIComponent(a.mapStyleId)+"/"+encodeURIComponent(a.srid)+"/"+a.sourceDate.getYear()+a.sourceDate.getMonth()+a.sourceDate.getDate()+"/L"+a.level+"/"+a.col+encodeURIComponent(",")+a.row+"."+a.formatSuffix;return this.url.indexOf("/",this.url.length-
1)!=-1?this.url+a:this.url+"/"+a},CLASS_NAME:"Geo.Service.CWMS"});
